/*
* Kendo UI Complete v2013.2.918 (http://kendoui.com)
* Copyright 2013 Telerik AD. All rights reserved.
*
* Kendo UI Complete commercial licenses may be obtained at
* https://www.kendoui.com/purchase/license-agreement/kendo-ui-complete-commercial.aspx
* If you do not own a commercial license, this file shall be governed by the trial license terms.
*/
!function(define){return define(["./kendo.dropdownlist.min","./kendo.editable.min","./kendo.multiselect.min","./kendo.window.min","./kendo.datepicker.min","./kendo.scheduler.recurrence.min","./kendo.scheduler.view.min","./kendo.scheduler.dayview.min","./kendo.scheduler.agendaview.min","./kendo.scheduler.monthview.min"],function(){!function(e,t){function i(e,t){var i,n=t.model.fields[t.field].validation;n&&(i=n.dateCompare,i&&R(i)&&i.message&&(e[_.attr("dateCompare-msg")]=i.message))}function n(e,t){return function(i){return i=e(i),r(i,"apply",t),i||[]}}function a(e,t){return function(i){return i&&("[object Array]"===B.call(i)||i instanceof _.data.ObservableArray||(i=[i])),r(i,"remove",t,!0),i=e(i),i||[]}}function r(e,t,i,n){var a,r,o;for(e=e||[],r=0,o=e.length;o>r;r++)a=e[r],n?a.startTimezone||a.endTimezone?i?(a.start=_.timezone.convert(a.start,a.startTimezone||a.endTimezone,i),a.end=_.timezone.convert(a.end,a.endTimezone||a.startTimezone,i),a.start=_.timezone[t](a.start,i),a.end=_.timezone[t](a.end,i)):(a.start=_.timezone[t](a.start,a.startTimezone||a.endTimezone),a.end=_.timezone[t](a.end,a.endTimezone||a.startTimezone)):i&&(a.start=_.timezone[t](a.start,i),a.end=_.timezone[t](a.end,i)):a.startTimezone||a.endTimezone?(a.start=_.timezone[t](a.start,a.startTimezone||a.endTimezone),a.end=_.timezone[t](a.end,a.endTimezone||a.startTimezone),i&&(a.start=_.timezone.convert(a.start,a.startTimezone||a.endTimezone,i),a.end=_.timezone.convert(a.end,a.endTimezone||a.startTimezone,i))):i&&(a.start=_.timezone[t](a.start,i),a.end=_.timezone[t](a.end,i)),n&&delete a.uid;return e}function o(e,t){for(var i,n=e.length,a=0;n>a;a++)if(i=e[a],i.uid===t)return i}function s(e){var t=new Date(1980,0,1);return t.setHours(e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()),t}function d(e){var t,i,n,a,r;return e.filter("[name=end]").length&&(t=e.closest(".k-scheduler-edit-form"),i=t.find("[name=start]:visible"),n=t.find("[name=end]:visible"),n.length&&i.length&&(a=_.widgetInstance(i,_.ui),r=_.widgetInstance(n,_.ui),a&&r))?a.value()<=r.value():!0}function l(e,t,i,n){for(var a=e.length,r=[],o=0;a>o;o++)r=r.concat(e[o].expand(t,i,n));return r}function c(e){return delete e.name,delete e.prefix,delete e.remove,delete e.edit,delete e.add,delete e.navigate,e}function u(t){return function(i){e(_.format('<select data-{0}bind="value:{1}">',_.ns,t.field)).appendTo(i).kendoDropDownList({dataTextField:t.dataTextField,dataValueField:t.dataValueField,dataSource:t.dataSource,valuePrimitive:t.valuePrimitive,optionLabel:"None",template:_.format('<span class="k-scheduler-mark" style="background-color:#= data.{0}?{0}:"none" #"></span>#={1}#',t.dataColorField,t.dataTextField)})}}function v(t){return function(i){e(_.format('<select data-{0}bind="value:{1}">',_.ns,t.field)).appendTo(i).kendoMultiSelect({dataTextField:t.dataTextField,dataValueField:t.dataValueField,dataSource:t.dataSource,valuePrimitive:t.valuePrimitive,itemTemplate:_.format('<span class="k-scheduler-mark" style="background-color:#= data.{0}?{0}:"none" #"></span>#={1}#',t.dataColorField,t.dataTextField),tagTemplate:_.format('<span class="k-scheduler-mark" style="background-color:#= data.{0}?{0}:"none" #"></span>#={1}#',t.dataColorField,t.dataTextField)})}}function f(e,t){var i,n=e.end.getTime()-e.start.getTime(),a=new Date(e.start.getTime());return _.date.setTime(a,t),i=new Date(a.getTime()),_.date.setTime(i,n),{start:a,end:i}}var m,p,h,g,_=window.kendo,w=_.date,k=w.MS_PER_DAY,y=w.getDate,z=_.recurrence,T=_.keys,D=_.ui,b=D.Widget,S="string",x=D.Popup,E=D.Calendar,I=_.data.DataSource,R=e.isPlainObject,C=e.extend,H=e.proxy,B=Object.prototype.toString,V=e.isArray,A=".kendoScheduler",M="click",W="change",P="cancel",F="remove",N="save",O="add",U="edit",K=y(new Date),L="recurrenceException",j="yyyyMMddTHHmmssZ",q="Are you sure you want to delete this event?",Q="Do you want to delete only this event occurrence or the whole series?",J="Do you want to edit only this event occurrence or the whole series?",Y='<a class="k-button #=className#" #=attr# href="\\#">#=text#</a>',$=_.template('<div class="k-floatwrap k-header k-scheduler-toolbar k-secondary"><ul class="k-reset k-header k-toolbar k-scheduler-navigation"><li class="k-state-default k-nav-today"><a role="button" href="\\#" class="k-link">${messages.today}</a></li><li class="k-state-default k-nav-prev"><a role="button" href="\\#" class="k-link"><span class="k-icon k-i-arrow-w"></span></a></li><li class="k-state-default k-nav-next"><a role="button" href="\\#" class="k-link"><span class="k-icon k-i-arrow-e"></span></a></li><li class="k-state-default k-nav-current"><a role="button" href="\\#" class="k-link"><span class="k-icon k-i-calendar"></span><span data-#=ns#bind="text: formattedDate"></span></a></li></ul><ul class="k-reset k-header k-toolbar k-scheduler-views">#for(var view in views){#<li class="k-state-default k-view-#=view#" data-#=ns#name="#=view#"><a role="button" href="\\#" class="k-link">${views[view].title}</a></li>#}#</ul></div>'),Z=function(t,n){var a={name:n.field};i(a,n),e('<input type="text" required '+_.attr("type")+'="date"'+" "+_.attr("role")+'="datetimepicker" '+_.attr("bind")+'="value:'+n.field+',invisible:isAllDay" />').attr(a).appendTo(t),e('<input type="text" required '+_.attr("type")+'="date"'+" "+_.attr("role")+'="datepicker" '+_.attr("bind")+'="value:'+n.field+',visible:isAllDay" />').attr(a).appendTo(t),e("<span "+_.attr("bind")+'="text: '+n.field+'Timezone"></span>').appendTo(t),"end"===n.field&&e("<span "+_.attr("bind")+'="text: startTimezone, invisible: endTimezone"></span>').appendTo(t),e("<span "+_.attr("for")+'="'+n.field+'" class="k-invalid-msg"/>').hide().appendTo(t)},G=_.date.getMilliseconds,X=function(t,i){e("<div "+_.attr("bind")+'="value:'+i.field+'" />').attr({name:i.field}).appendTo(t).kendoRecurrenceEditor({start:i.model.start,timezone:i.timezone,messages:i.messages})},et=function(t,i){e('<a href="#" class="k-button">'+i.messages.timezoneEditorButton+"<a/>").click(i.click).appendTo(t)},tt=function(t,i){e("<div "+_.attr("bind")+'="value:'+i.field+'" />').attr({name:i.field}).toggle(i.visible).appendTo(t).kendoTimezoneEditor()},it=_.Class.extend({init:function(t,i){var r=t.timezone;this.reader=i,i.model&&(this.model=i.model),this.timezone=r,this.data=n(e.proxy(this.data,this),r),this.serialize=a(e.proxy(this.serialize,this),r)},errors:function(e){return this.reader.errors(e)},parse:function(e){return this.reader.parse(e)},data:function(e){return this.reader.data(e)},total:function(e){return this.reader.total(e)},groups:function(e){return this.reader.groups(e)},aggregates:function(e){return this.reader.aggregates(e)},serialize:function(e){return this.reader.serialize(e)}}),nt=_.data.Model.define({init:function(e){var t=this;_.data.Model.fn.init.call(t,e)},clone:function(t,i){var n=this.uid,a=new this.constructor(e.extend({},this.toJSON(),t));return i||(a.uid=n),a},duration:function(){var e=this.end,t=this.start,i=(e.getTimezoneOffset()-t.getTimezoneOffset())*_.date.MS_PER_MINUTE;return e-t-i},expand:function(e,t,i){return z?z.expand(this,e,t,i):[this]},update:function(e){for(var t in e)this.set(t,e[t]);this.set("startTime",s(this.start)),this.set("endTime",s(this.end))},isMultiDay:function(){return this.isAllDay||this.duration()>=_.date.MS_PER_DAY},isException:function(){return this.id&&this.recurrenceId},isOccurrence:function(){return this.isNew()&&this.recurrenceId},isRecurring:function(){return!(!this.recurrenceRule&&!this.recurrenceId)},isRecurrenceHead:function(){return!(!this.id||!this.recurrenceRule)},toOccurrence:function(t){return t=e.extend(t,{recurrenceException:null,recurrenceRule:null,recurrenceId:this.id||this.recurrenceId,id:this.defaults.id}),t[this.idField]=this.defaults.id,this.clone(t,!0)},toJSON:function(){var e=_.data.Model.fn.toJSON.call(this);return e.uid=this.uid,delete e.startTime,delete e.endTime,e},set:function(e,t){var i,n,a,r=this.isAllDay||!1;_.data.Model.fn.set.call(this,e,t),"isAllDay"==e&&t!=r&&(i=_.date.getDate(this.start),n=new Date(this.end),a=_.date.getMilliseconds(n),0===a&&t&&(a=k),this.set("start",i),t===!0?(_.date.setTime(n,-a),i>n&&(n=i)):_.date.setTime(n,k-a),this.set("end",n))},id:"id",fields:{id:{type:"number"},title:{defaultValue:"",type:"string"},start:{type:"date",validation:{required:!0}},startTimezone:{type:"string"},end:{type:"date",validation:{required:!0,dateCompare:{value:d,message:"End date should be greater than or equal to the start date"}}},endTimezone:{type:"string"},recurrenceRule:{defaultValue:"",type:"string"},recurrenceException:{defaultValue:"",type:"string"},isAllDay:{type:"boolean",defaultValue:!1},description:{type:"string"}}}),at=I.extend({init:function(e){I.fn.init.call(this,C(!0,{},{schema:{modelBase:nt,model:nt}},e)),this.reader=new it(this.options.schema,this.reader)},expand:function(e,t){var i=this.view(),n={};return e&&t&&(t=new Date(t.getTime()+k-1),n={logic:"or",filters:[{logic:"and",filters:[{field:"start",operator:"gte",value:e},{field:"end",operator:"gte",value:e},{field:"start",operator:"lte",value:t}]},{logic:"and",filters:[{field:"start",operator:"lte",value:new Date(e.getTime()+k-1)},{field:"end",operator:"gte",value:e}]}]},i=new _.data.Query(l(i,e,t,this.reader.timezone)).filter(n).toArray()),i},cancelChanges:function(e){e&&e.isOccurrence()&&this._removeExceptionDate(e),I.fn.cancelChanges.call(this,e)},insert:function(e,t){if(t){if(!(t instanceof nt)){var i=t;t=this._createNewModel(),t.accept(i)}return(t.isRecurrenceHead()||t.recurrenceId)&&(t=t.recurrenceId?t:t.toOccurrence(),this._addExceptionDate(t)),I.fn.insert.call(this,e,t)}},remove:function(e){return e.isRecurrenceHead()?this._removeExceptions(e):e.isRecurring()&&this._addExceptionDate(e),I.fn.remove.call(this,e)},_removeExceptions:function(e){for(var t=this.data().slice(0),i=t.shift(),n=e.id;i;)i.recurrenceId===n&&I.fn.remove.call(this,i),i=t.shift();e.set(L,"")},_removeExceptionDate:function(e){var t,i,n;e.recurrenceId&&(t=this.get(e.recurrenceId),t&&(i=e.start,i=_.timezone.convert(i,this.reader.timezone||i.getTimezoneOffset(),"Etc/UTC"),n=_.toString(i,j)+";",t.set(L,t.recurrenceException.replace(n,""))))},_addExceptionDate:function(e){var t=e.start,i=this.reader.timezone,n=this.get(e.recurrenceId),a=n.recurrenceException||"";z.isException(a,t,i)||(t=_.timezone.convert(t,i||t.getTimezoneOffset(),"Etc/UTC"),a+=_.toString(t,j)+";",n.set(L,a))}});at.create=function(e){e=e&&e.push?{data:e}:e;var t=e||{},i=t.data;if(t.data=i,!(t instanceof at)&&t instanceof _.data.DataSource)throw Error("Incorrect DataSource type. Only SchedulerDataSource instances are supported");return t instanceof at?t:new at(t)},C(!0,_.data,{SchedulerDataSource:at,SchedulerDataReader:it,SchedulerEvent:nt}),m={update:{text:"Save",className:"k-scheduler-update"},canceledit:{text:"Cancel",className:"k-scheduler-cancel"},destroy:{text:"Delete",imageClass:"k-delete",className:"k-scheduler-delete",iconClass:"k-icon"}},p=b.extend({init:function(t,i){var n=this;b.fn.init.call(n,t,i),n.options.views&&n.options.views.length||(n.options.views=["day","week"]),n.resources=[],n._initModel(),n._wrapper(),n._views(),n._toolbar(),n._dataSource(),n._resources(),n._resizeHandler=H(n._resize,n),n.wrapper.on("mousedown"+A+" selectstart"+A,function(e){e.preventDefault()}),n.options.editable&&n.options.editable.resize!==!1&&n._resizable(),n.options.editable&&n.options.editable.move!==!1&&n._movable(),e(window).on("resize"+A,n._resizeHandler),n.options.messages&&n.options.messages.recurrence&&(z.options=n.options.messages.recurrence),n._selectable(),n._ariaId=_.guid()},_selectable:function(){var t,i=this,n=i.wrapper,a=_.support.mobileOS?"touchend":"mousedown";i.options.selectable&&(i._tabindex(),n.on(a,".k-scheduler-header-all-day td, .k-scheduler-content td, .k-event",function(e){i._createSelection(e.currentTarget),n.focus()}),t=e.proxy(i._mouseMove,i),n.on("mousedown"+A,".k-scheduler-header-all-day td, .k-scheduler-content td",function(){n.on("mousemove"+A,".k-scheduler-header-all-day td, .k-scheduler-content td",t)}),n.on("mouseup"+A+" mouseleave"+A,function(){n.off("mousemove"+A,".k-scheduler-header-all-day td, .k-scheduler-content td",t)}),n.on("focus"+A,function(){i._selection||i._createSelection(e(".k-scheduler-content").find("td:first")),i._select()}),n.on("focusout"+A,function(){i.view().clearSelection(),i._ctrlKey=i._shiftKey=!1}),n.on("keydown"+A,H(i._keydown,i)),n.on("keyup"+A,function(e){i._ctrlKey=e.ctrlKey,i._shiftKey=e.shiftKey}))},_select:function(){var e,t,i=this.view(),n=this.wrapper,a=i.current(),r=this._selection;a&&(a.removeAttribute("id"),a.removeAttribute("aria-label"),n.removeAttr("aria-activedescendant")),i.select(r),a=i.current(),a&&(t=r,r.events[0]?(t=this.occurrenceByUid(r.events[r.events.length-1])||r,e=_.format(this.options.messages.ariaEventLabel,t.title,t.start,t.start)):e=_.format(this.options.messages.ariaSlotLabel,t.start,t.end),a.setAttribute("id",this._ariaId),a.setAttribute("aria-label",e),n.attr("aria-activedescendant",this._ariaId))},_mouseMove:function(t){var i=this;clearTimeout(i._moveTimer),i._moveTimer=setTimeout(function(){var n,a,r,o=i.view(),s=i._selection;s&&(n=o.selectionByElement(e(t.currentTarget)),n&&s.groupIndex===n.groupIndex&&(a=n.startDate(),r=n.endDate(),a>=s.end?s.backward=!1:r<=s.start&&(s.backward=!0),s.backward?s.start=a:s.end=r,i._select()))},5)},_viewByIndex:function(e){var t,i=this.views;for(t in i){if(!e)return t;e--}},_keydown:function(t){var i=this,n=t.keyCode,a=i.view(),r=a.options.editable,o=i._selection,s=t.shiftKey;i._ctrlKey=t.ctrlKey,i._shiftKey=t.shiftKey,n===T.TAB?a.moveToEvent(o,s)&&(i._select(),t.preventDefault()):r&&n===T.ENTER?o.events.length?r.update!==!1&&i.editEvent(o.events[0]):r.create!==!1&&(o.isAllDay&&(o=e.extend({},o,{end:_.date.addDays(o.end,-1)})),i.addEvent(o)):n===T.DELETE?i.removeEvent(o.events[0]):n>=49&&57>=n?i.view(i._viewByIndex(n-49)):a.move(o,n,s)&&(a.inRange(o)?i._select():i.date(o.start),t.preventDefault()),i._adjustSelectedDate()},_createSelection:function(t){var i,n,a;this._selection&&(this._ctrlKey||this._shiftKey)||(this._selection={events:[],groupIndex:0}),t=e(t),a=this._selection,i=t.attr(_.attr("uid")),n=this.view().selectionByElement(t),n&&(a.groupIndex=n.groupIndex||0),i&&(n=o(this._data,i)),n&&n.uid&&(i=[n.uid]),this._updateSelection(n,i),this._adjustSelectedDate()},_updateSelection:function(e,t){var i,n,a=this._selection;e&&a&&(this._shiftKey&&a.start&&a.end?(i=e.end<a.end,n=this.view(),a.end=e.endDate?e.endDate():e.end,i&&n._timeSlotInterval&&_.date.setTime(a.end,-n._timeSlotInterval())):(a.start=e.startDate?e.startDate():e.start,a.end=e.endDate?e.endDate():e.end),a.isAllDay="isDaySlot"in e?e.isDaySlot:e.isAllDay,a.index=e.index,a.events=this._ctrlKey?a.events.concat(t||[]):t||[])},options:{name:"Scheduler",date:K,editable:!0,autoBind:!0,timezone:"",messages:{today:"Today",save:"Save",cancel:"Cancel",destroy:"Delete",deleteWindowTitle:"Delete event",ariaSlotLabel:"Selected from {0:t} to {1:t}",ariaEventLabel:"{0} on {1:D} at {2:t}",views:{day:"Day",week:"Week",agenda:"Agenda",month:"Month"},recurrenceMessages:{deleteWindowTitle:"Delete Recurring Item",deleteWindowOccurrence:"Delete current occurrence",deleteWindowSeries:"Delete the series",editWindowTitle:"Edit Recurring Item",editWindowOccurrence:"Edit current occurrence",editWindowSeries:"Edit the series"},editor:{title:"Title",start:"Start",end:"End",allDayEvent:"All day event",description:"Description",repeat:"Repeat",timezone:" ",startTimezone:"Start timezone",endTimezone:"End timezone",separateTimezones:"Use separate start and end time zones",timezoneEditorTitle:"Timezones",timezoneEditorButton:"Time zone",editorTitle:"Event"}},height:null,width:null,resources:[],group:{resources:[],direction:"horizontal"},views:[],selectable:!1},events:[F,U,P,N,"add","dataBinding","dataBound","moveStart","move","moveEnd","resizeStart","resize","resizeEnd","navigate"],destroy:function(){var t,i=this;b.fn.destroy.call(i),i.dataSource&&i.dataSource.unbind(W,i._refreshHandler),i.calendar&&(i.calendar.destroy(),i.popup.destroy()),i.view()&&i.view().destroy(),i._destroyEditable(),t=i.element.add(i.wrapper).add(i.toolbar).add(i.popup),t.off(A),e(window).off("resize"+A,i._resizeHandler),_.destroy(i.wrapper)},setDataSource:function(e){this.options.dataSource=e,this._dataSource(),this.options.autoBind&&e.fetch()},items:function(){return this.wrapper.children(".k-event, .k-task")},_movable:function(){var t,i,n,a=this;a._moveDraggable=new _.ui.Draggable(a.element,{distance:0,filter:".k-event",dragstart:function(e){var r=a.view(),o=e.currentTarget;n=a.occurrenceByUid(o.attr(_.attr("uid"))),t=r._slotByPosition(e.x.location,e.y.location),i=t,(!t||a.trigger("moveStart",{event:n}))&&e.preventDefault()},drag:function(e){var r,o,s=a.view(),d=s._slotByPosition(e.x.location,e.y.location);d&&(s._updateMoveHint(n,t,d),r=d.start-t.start,o=f(n,r),a.trigger("move",{event:n,slot:{element:d.element,start:d.startDate(),end:d.endDate()},resources:s._resourceBySlot(d),start:o.start,end:o.end})?s._updateMoveHint(n,t,i):i=d)},dragend:function(){var r,o,s,d,l,c,u;a.view()._removeMoveHint(),r=i.start-t.start,o=f(n,r),s=o.start,d=o.end,l=a.view()._resourceBySlot(i),c=a.view()._resourceBySlot(t),u=a.trigger("moveEnd",{event:n,slot:{element:i.element,start:i.startDate(),end:i.endDate()},start:s,end:d,resources:l}),u||n.start.getTime()==s.getTime()&&n.end.getTime()==d.getTime()&&_.stringify(l)==_.stringify(c)||a._updateEvent(null,n,e.extend({start:s,end:d},l))},dragcancel:function(){a.view()._removeMoveHint()}})},_resizable:function(){function t(e){var t,i={"k-resize-e":"east","k-resize-w":"west","k-resize-n":"north","k-resize-s":"south"};for(t in i)if(e.hasClass(t))return i[t]}var i,n,a,r=this;r._resizeDraggable=new _.ui.Draggable(r.element,{distance:0,filter:".k-resize-handle",dragstart:function(t){var o,s,d,l=e(t.currentTarget),c=l.closest(".k-event"),u=c.attr(_.attr("uid"));a=r.occurrenceByUid(u),r.trigger("resizeStart",{event:a})&&t.preventDefault(),o=r.view(),s=this.element.find(_.format(".k-event[{0}={1}]",_.attr("uid"),u)),c=s.first(),d=c.offset(),i=o._slotByPosition(d.left,d.top),c=s.last(),d=c.offset(),d.left+=c[0].clientWidth,d.top+=c[0].clientHeight,n=o._slotByPosition(d.left,d.top)},drag:function(o){var s,d,l,c=e(o.currentTarget),u=t(c),v=r.view(),f=v._slotByPosition(o.x.location,o.y.location);f&&(s=!1,d=i,l=n,"south"==u?!f.isDaySlot&&i.groupIndex==f.groupIndex&&f.end-_.date.toUtcTime(a.start)>=v._timeSlotInterval()&&(n=f,s=!0):"north"==u?!f.isDaySlot&&n.groupIndex==f.groupIndex&&_.date.toUtcTime(a.end)-f.start>=v._timeSlotInterval()&&(i=f,s=!0):"east"==u?f.isDaySlot&&i.groupIndex==f.groupIndex&&_.date.toUtcTime(_.date.getDate(f.endDate()))>=_.date.toUtcTime(_.date.getDate(a.start))&&(n=f,s=!0):"west"==u&&f.isDaySlot&&n.groupIndex==f.groupIndex&&_.date.toUtcTime(_.date.getDate(a.end))>=_.date.toUtcTime(_.date.getDate(f.startDate()))&&(i=f,s=!0),s&&(r.trigger("resize",{event:a,slot:{element:f.element,start:f.startDate(),end:f.endDate()},start:i.startDate(),end:n.endDate(),resources:v._resourceBySlot(f)})?(i=d,n=l):v._updateResizeHint(a,i,n)))},dragend:function(o){var s,d=e(o.currentTarget),l=new Date(a.start.getTime()),c=new Date(a.end.getTime()),u=t(d);r.view()._removeResizeHint(),"south"==u?c=n.endDate():"north"==u?l=i.startDate():"east"==u?c=a.isAllDay?_.date.getDate(n.startDate()):_.date.getDate(n.endDate()):"west"==u&&(l=new Date(i.start),l.setHours(0),l.setMinutes(0)),s=r.trigger("resizeEnd",{event:a,slot:{element:n.element,start:n.startDate(),end:n.endDate()},start:l,end:c,resources:r.view()._resourceBySlot(n)}),!s&&c.getTime()>=l.getTime()&&(a.start.getTime()!=l.getTime()||a.end.getTime()!=c.getTime())&&r._updateEvent(u,a,{start:l,end:c})},dragcancel:function(){r.view()._removeResizeHint()}})},_updateEvent:function(e,t,i){var n=this,a=function(e){try{n._preventRefresh=!0,e.update(i)}finally{n._preventRefresh=!1}n.refresh(),n.trigger(N,{event:e})||(n._updateSelection(e),n.dataSource.sync())},r=function(e){return e.recurrenceRule?n.dataSource.getByUid(e.uid):n.dataSource.get(e.recurrenceId)},o=function(){var n,o,s=r(t);("south"==e||"north"==e)&&(i.start&&(n=_.date.getDate(s.start),_.date.setTime(n,G(i.start)),i.start=n),i.end&&(o=_.date.getDate(s.end),_.date.setTime(o,G(i.end)),i.end=o)),a(s)},s=function(){var e=r(t).toOccurrence({start:t.start,end:t.end});a(n.dataSource.add(e))},d=n.options.messages.recurrenceMessages;t.recurrenceRule||t.isOccurrence()?n.showDialog({title:d.editWindowTitle,text:d.editRecurring?d.editRecurring:J,buttons:[{text:d.editWindowOccurrence,click:s},{text:d.editWindowSeries,click:o}]}):a(n.dataSource.getByUid(t.uid))},_modelForContainer:function(t){return t=e(t).closest("["+_.attr("uid")+"]"),this.dataSource.getByUid(t.attr(_.attr("uid")))},showDialog:function(t){var i,n,a=_.format("<div class='k-popup-edit-form'><div class='k-edit-form-container'><p class='k-popup-message'>{0}</p>",t.text),r=this;for(a+='<div class="k-edit-buttons k-state-default">',i=0;i<t.buttons.length;i++)a+=r._createButton(t.buttons[i]);a+="</div></div></div>",n=e(a).appendTo(r.wrapper).eq(0).on("click",".k-button",function(i){i.preventDefault(),n.close();var a=e(i.currentTarget).index();t.buttons[a].click()}).kendoWindow({modal:!0,resizable:!1,draggable:!1,title:t.title,visible:!1,close:function(){this.destroy(),r.focus()}}).getKendoWindow(),n.center().open()},focus:function(){this.wrapper.focus()},_confirmation:function(e){var t,i,n=this.options.editable;n===!0||n.confirmation!==!1?(t=this.options.messages,i=typeof n.confirmation===S?n.confirmation:q,this.showDialog({text:i,title:t.deleteWindowTitle,buttons:[{name:"destroy",text:t.destroy,click:function(){e()}},{name:"canceledit",text:t.cancel,click:function(){e(!0)}}]})):e()},addEvent:function(e){var t,i,n=this.editable,a=this.dataSource;e=e||{},i=this.trigger("add",{event:e}),!i&&(n&&n.end()||!n)&&(this.cancelEvent(),e&&e.toJSON&&(e=e.toJSON()),t=a.add(e),t&&(this.cancelEvent(),this._editEvent(t)))},saveEvent:function(){var e=this,t=e._editContainer,i=e._modelForContainer(t),n=e.editable;t&&n&&n.end()&&!e.trigger(N,{container:t,event:i})&&(i.dirty||e._convertDates(i,"remove"),i.isRecurrenceHead()&&e.dataSource._removeExceptions(i),e.dataSource.sync())},cancelEvent:function(){var e,t=this,i=t._editContainer;i&&(e=t._modelForContainer(i),t.dataSource.cancelChanges(e),t._destroyEditable())},editEvent:function(e){var t="string"==typeof e?this.occurrenceByUid(e):e;t&&(this.cancelEvent(),t.isRecurring()?this._editRecurringDialog(t):this._editEvent(t))},_editEvent:function(e){var t,i=this;i._createPopupEditor(e),t=i._editContainer,t.on(M+A,"a.k-scheduler-cancel",function(n){n.preventDefault(),n.stopPropagation(),i.trigger(P,{container:t,event:e})||i.cancelEvent()}),t.on(M+A,"a.k-scheduler-update",function(e){e.preventDefault(),e.stopPropagation(),i.saveEvent()})},_editRecurringDialog:function(e){var t=this,i=function(){e.isException()?t._editEvent(e):t.addEvent(e)},n=function(){e.recurrenceId&&(e=t.dataSource.get(e.recurrenceId)),t._editEvent(e)},a=t.options.messages.recurrenceMessages;t.showDialog({title:a.editWindowTitle,text:a.editRecurring?a.editRecurring:J,buttons:[{text:a.editWindowOccurrence,click:i},{text:a.editWindowSeries,click:n}]})},_createButton:function(e){var t=e.template||Y,i=typeof e===S?e:e.name||e.text,n={className:"k-scheduler-"+(i||"").replace(/\s/g,""),text:i,attr:""};if(!(i||R(e)&&e.template))throw Error("Custom commands should have name specified");return R(e)?(e.className&&(e.className+=" "+n.className),"edit"===i&&R(e.text)&&(e=C(!0,{},e),e.text=e.text.edit),n=C(!0,n,m[i],e)):n=C(!0,n,m[i]),_.template(t)(n)},_convertDates:function(e,t){var i=this.dataSource.reader.timezone,n=e.startTimezone,a=e.endTimezone,r=e.start,o=e.start;t=t||"apply",n=n||a,a=a||n,n&&(i?"apply"===t?(r=_.timezone.convert(e.start,i,n),o=_.timezone.convert(e.end,i,a)):(r=_.timezone.convert(e.start,n,i),o=_.timezone.convert(e.end,a,i)):(r=_.timezone[t](e.start,n),o=_.timezone[t](e.end,a)),e._set("start",r),e._set("end",o))},_revertTimezones:function(e){e.set("startTimezone",this._startTimezone),e.set("endTimezone",this._endTimezone),delete this._startTimezone,delete this._endTimezone},_createTimezonePopup:function(e,t){var i,n=this,a=n._editContainer.find(".k-scheduler-timezones"),r=a.find(".k-timezone-toggle"),o=a.find("[data-role=timezoneeditor]:first").data("kendoTimezoneEditor"),s=a.find(".k-edit-label:last").add(a.find(".k-edit-field:last")),d=a.find(".k-scheduler-savetimezone"),l=a.find(".k-scheduler-canceltimezone"),c=n._timezonePopup;n._startTimezone=e.startTimezone,n._endTimezone=e.endTimezone,c||(n._timezonePopup=c=a.kendoWindow({modal:!0,resizable:!1,draggable:!0,title:n.options.messages.editor.timezoneEditorTitle,visible:!1,close:function(i){i.userTriggered&&n._revertTimezones(e),t&&t.focus()}}),r.click(function(){s.toggle(r.prop("checked")),e.set("endTimezone","")}),d.click(function(e){e.preventDefault(),i.close()}),l.click(function(t){t.preventDefault(),n._revertTimezones(e),i.close()}),o&&o.bind("change",function(){var t=this.value();r.prop("disabled",!t),t||(s.hide(),e.set("endTimezone",""),r.prop("checked",!1))})),r.prop("checked",e.endTimezone).prop("disabled",!e.endTimezone),s.toggle(e.endTimezone),i=c.data("kendoWindow"),i.center().open()},_createPopupEditor:function(i){var n,a,r,o,s,d,l,c,f=this,m=f.options.editable,p="<div "+_.attr("uid")+'="'+i.uid+'" class="k-popup-edit-form k-scheduler-edit-form"><div class="k-edit-form-container">',h=m.template,g=f.options.messages,w=g.save,k=g.cancel,y=function(e){e.preventDefault(),f._createTimezonePopup(i,this)},z=[{field:"title",title:g.editor.title},{field:"start",title:g.editor.start,editor:Z},{field:"end",title:g.editor.end,editor:Z},{field:"isAllDay",title:g.editor.allDayEvent}],T=R(m)?m.window:{},D=C({},_.Template,f.options.templateSettings),b=D.paramName,x=[];if(h)typeof h===S&&(h=window.unescape(h)),p+=_.template(h,D)(i);else{_.timezone.windows_zones&&!i.isAllDay&&(z.push({field:"timezone",title:g.editor.timezone,editor:et,click:y,messages:g.editor}),z.push({field:"startTimezone",title:g.editor.startTimezone,editor:tt}),z.push({field:"endTimezone",title:g.editor.endTimezone,editor:tt})),i.recurrenceId||z.push({field:"recurrenceRule",title:g.editor.repeat,editor:X,timezone:this.dataSource.reader.timezone,messages:g.recurrenceEditor}),"description"in i&&z.push({field:"description",title:g.editor.description,editor:'<textarea name="description" class="k-textbox"/>'});for(a=0;a<f.resources.length;a++)r=f.resources[a],z.push({field:r.field,title:r.title,editor:r.multiple?v(r):u(r)});for(o=0,s=z.length;s>o;o++)d=z[o],"startTimezone"===d.field&&(p+='<div class="k-popup-edit-form k-scheduler-edit-form k-scheduler-timezones" style="display:none">',p+='<div class="k-edit-form-container">',p+='<div class="k-edit-label"></div>',p+='<div class="k-edit-field"><label><input class="k-timezone-toggle" type="checkbox" />'+g.editor.separateTimezones+"</label></div>"),p+='<div class="k-edit-label"><label for="'+d.field+'">'+(d.title||d.field||"")+"</label></div>",!i.editable||i.editable(d.field)?(x.push(d),p+="<div "+_.attr("container-for")+'="'+d.field+'" class="k-edit-field"></div>'):(l="#:",d.field?(d=_.expr(d.field,b),l+=d+"==null?'':"+d):l+="''",l+="#",l=_.template(l,D),p+='<div class="k-edit-field">'+l(i)+"</div>"),"endTimezone"===d.field&&(p+='<div class="k-edit-buttons k-state-default">',p+=f._createButton({name:"savetimezone",text:g.save})+f._createButton({name:"canceltimezone",text:g.cancel}),p+="</div></div></div>")}p+='<div class="k-edit-buttons k-state-default">',p+=f._createButton({name:"update",text:w,attr:n})+f._createButton({name:"canceledit",text:k,attr:n}),p+="</div></div></div>",c=f._editContainer=e(p).appendTo(f.wrapper).eq(0).kendoWindow(C({modal:!0,resizable:!1,draggable:!0,title:g.editor.editorTitle,visible:!1,close:function(e){if(e.userTriggered){if(f.trigger(P,{container:c,event:i}))return e.preventDefault(),t;f.cancelEvent(),f.focus()}}},T)),i.isNew()||f._convertDates(i),f.editable=f._editContainer.kendoEditable({fields:x,model:i,clearContainer:!1,validateOnBlur:!0}).data("kendoEditable"),f.trigger(U,{container:c,event:i})?f.cancelEvent():c.data("kendoWindow").center().open()},_destroyEditable:function(){var e=this,t=function(){e.editable&&(e.editable.destroy(),e.editable=null,e._editContainer=null)};e.editable&&(e._timezonePopup&&e._timezonePopup.data("kendoWindow")&&(e._timezonePopup.data("kendoWindow").destroy(),e._timezonePopup=null),e._editContainer.data("kendoWindow").bind("deactivate",t).close())},removeEvent:function(e){var t=this,i="string"==typeof e?t.occurrenceByUid(e):e;i&&(i.isRecurring()?t._deleteRecurringDialog(i):t._confirmation(function(e){e||t._removeEvent(i)}))},occurrenceByUid:function(e){var t=this.dataSource.getByUid(e);return t||(t=o(this._data,e)),t},occurrencesInRange:function(e,t){return new _.data.Query(this._data).filter({logic:"or",filters:[{logic:"and",filters:[{field:"start",operator:"gte",value:e},{field:"end",operator:"gte",value:e},{field:"start",operator:"lt",value:t}]},{logic:"and",filters:[{field:"start",operator:"lte",value:e},{field:"end",operator:"gt",value:e}]}]}).toArray()},_removeEvent:function(e){this.trigger(F,{event:e})||this.dataSource.remove(e)&&this.dataSource.sync()},_deleteRecurringDialog:function(e){var t=this,i=function(){var i=e.recurrenceId?e:e.toOccurrence();t._removeEvent(i)},n=function(){e.recurrenceId&&(e=t.dataSource.get(e.recurrenceId)),t._removeEvent(e)},a=t.options.messages.recurrenceMessages;t.showDialog({title:a.deleteWindowTitle,text:a.deleteRecurring?a.deleteRecurring:Q,buttons:[{text:a.deleteWindowOccurrence,click:i},{text:a.deleteWindowSeries,click:n}]})},_unbindView:function(e){e.destroy()},_bindView:function(e){var t=this;t.options.editable&&(t._viewRemoveHandler&&e.unbind(F,t._viewRemoveHandler),t._viewRemoveHandler=function(e){t.removeEvent(e.uid)},e.bind(F,t._viewRemoveHandler),t._viewAddHandler&&e.unbind(O,t._viewAddHandler),t._viewAddHandler=function(e){t.addEvent(e.eventInfo)},e.bind(O,this._viewAddHandler),t._viewEditHandler&&e.unbind(U,t._viewEditHandler),t._viewEditHandler=function(e){t.editEvent(e.uid)},e.bind(U,this._viewEditHandler)),t._viewNavigateHandler&&e.unbind("navigate",t._viewNavigateHandler),t._viewNavigateHandler=function(e){var i,n;e.view&&(i="isWorkDay"in e,n=i?"changeWorkDay":"changeView",t.trigger("navigate",{view:e.view,isWorkDay:e.isWorkDay,action:n,date:e.date})||(i&&(t._workDayMode=e.isWorkDay),t._selectView(e.view),t.date(e.date)))},e.bind("navigate",t._viewNavigateHandler),t._viewActivateHandler&&e.unbind("activate",t._viewActivateHandler),t._viewActivateHandler=function(){var e=this;t._selection&&(e.constrainSelection(t._selection),t._select(),t._adjustSelectedDate())},e.bind("activate",t._viewActivateHandler)},_selectView:function(e){var t=this;e&&t.views[e]&&(t._selectedView&&t._unbindView(t._selectedView),t._selectedView=t._renderView(e),t._selectedViewName=e,t.toolbar.find(".k-scheduler-views li").removeClass("k-state-selected").end().find(".k-view-"+e).addClass("k-state-selected"))},view:function(e){var i=this;return e?(i._selectView(e),i.rebind(),t):i._selectedView},_renderView:function(e){var t=this._initializeView(e);return this._bindView(t),this._model.set("formattedDate",t.dateForTitle()),t},_resize:function(){this.refresh({action:"resize"})},_adjustSelectedDate:function(){var e=this._model.selectedDate,t=this._selection,i=t.start;i&&!_.date.isInDateRange(e,y(i),y(t.end))&&e.setFullYear(i.getFullYear(),i.getMonth(),i.getDate())},_initializeView:function(e){var t,i,n=this.views[e];if(n){if(t=R(n),i=n.type,typeof i===S&&(i=_.getter(n.type)(window)),!i)throw Error("There is no such view");n=new i(this.wrapper,c(C(!0,{},this.options,t?n:{},{resources:this.resources,date:this.date(),workDay:this._workDayMode})))}return n},_views:function(){var e,t,i,n,a,r,o,s,d,l=this.options.views;for(this.views={},o=0,s=l.length;s>o;o++)d=!1,e=l[o],n=R(e),n?(r=a=e.type?e.type:e,typeof r!==S&&(a=e.title,d=!0)):r=a=e,t=h[a],t&&!d&&(e.type=t.type,t.title=this.options.messages.views[a],"day"===t.type?t.messages={allDay:this.options.messages.allDay}:"agenda"===t.type&&(t.messages={event:this.options.messages.event,date:this.options.messages.date,time:this.options.messages.time})),e=C({title:a},t,n?e:{}),a&&(this.views[a]=e,(!i||e.selected)&&(i=a));
i&&(this._selectedViewName=i)},rebind:function(){this.dataSource.fetch()},_dataSource:function(){var e=this,t=e.options,i=t.dataSource;i=V(i)?{data:i}:i,!t.timezone||i instanceof at||(i=C(!0,i,{schema:{timezone:t.timezone}})),e.dataSource&&e._refreshHandler?e.dataSource.unbind(W,e._refreshHandler):e._refreshHandler=H(e.refresh,e),e.dataSource=_.data.SchedulerDataSource.create(i).bind(W,e._refreshHandler)},_resources:function(){var t,i,n,a,r,o=this,s=o.options.resources;for(t=0;t<s.length;t++){if(i=s[t],n=i.field,a=i.dataSource,!n||!a)throw Error('The "field" and "dataSource" options of the scheduler resource are mandatory.');o.resources.push({field:n,name:i.name||n,title:i.title||n,dataTextField:i.dataTextField||"text",dataValueField:i.dataValueField||"value",dataColorField:i.dataColorField||"color",valuePrimitive:null!=i.valuePrimitive?i.valuePrimitive:!0,multiple:i.multiple||!1,dataSource:_.data.DataSource.create(a)})}r=e.map(o.resources,function(e){return e.dataSource.fetch()}),e.when.apply(null,r).then(function(){o.options.autoBind?o.view(o._selectedViewName):o._selectView(o._selectedViewName)})},_initModel:function(){var e=this;e._model=_.observable({selectedDate:this.options.date,formattedDate:""}),e._model.bind("change",function(t){"selectedDate"===t.field&&e.view(e._selectedViewName)})},_wrapper:function(){var e=this,t=e.options.height;e.wrapper=e.element.addClass("k-widget k-scheduler k-floatwrap").attr("role","grid").attr("aria-multiselectable",!0),t&&e.wrapper.css("height",t)},date:function(e){return null!=e&&this._model.set("selectedDate",e),y(this._model.get("selectedDate"))},_toolbar:function(){var i=this,n=i.options,a=e($({messages:n.messages,ns:_.ns,views:i.views}));i.wrapper.append(a),i.toolbar=a,_.bind(i.toolbar,i._model),a.on(M+A,".k-scheduler-navigation li",function(n){var a=e(this),r=new Date(i.date()),o="";if(n.preventDefault(),a.hasClass("k-nav-today"))o="today",r=new Date;else if(a.hasClass("k-nav-next"))o="next",r=i.view().nextDate();else if(a.hasClass("k-nav-prev"))o="previous",r=i.view().previousDate();else if(a.hasClass("k-nav-current"))return i._showCalendar(),t;i.trigger("navigate",{view:i._selectedViewName,action:o,date:r})||i.date(r)}),a.on(M+A,".k-scheduler-views li",function(t){t.preventDefault();var n=e(this).attr(_.attr("name"));i.trigger("navigate",{view:n,action:"changeView",date:i.date()})||i.view(n)}),a.find("li").hover(function(){e(this).addClass("k-state-hover")},function(){e(this).removeClass("k-state-hover")})},_showCalendar:function(){var t=this,i=t.toolbar.find(".k-nav-current"),n=e('<div class="k-calendar-container"><div class="k-scheduler-calendar"/></div>');t.popup||(t.popup=new x(n,{anchor:i,activate:function(){t.calendar||(t.calendar=new E(this.element.find(".k-scheduler-calendar"),{change:function(){var e=this.value();t.trigger("navigate",{view:t._selectedViewName,action:"changeDate",date:e})||(t.date(e),t.popup.close())}})),t.calendar.value(t.date())},copyAnchorStyles:!1})),t.popup.open()},refresh:function(e){var t=this.view();e&&"itemchange"===e.action&&(this.editable||this._preventRefresh)||(this.trigger("dataBinding"),e&&"resize"===e.action&&this.editable||this._destroyEditable(),this._data=this.dataSource.expand(t.startDate(),t.endDate()),t.render(this._data),this.trigger("dataBound"))}}),h={day:{type:"kendo.ui.DayView"},week:{type:"kendo.ui.WeekView"},agenda:{type:"kendo.ui.AgendaView"},month:{type:"kendo.ui.MonthView"}},D.plugin(p),g=b.extend({init:function(e,t){var i=this,n=_.timezone.windows_zones;if(!n||!_.timezone.zones_titles)throw Error("kendo.timezones.min.js is not included.");b.fn.init.call(i,e,t),i.wrapper=i.element,i._zonesQuery=new _.data.Query(n),i._zoneTitleId=_.guid(),i._zoneTitlePicker(),i._zonePicker(),i.value(i.options.value)},options:{name:"TimezoneEditor",value:"",optionLabel:"No timezone"},events:["change"],_zoneTitlePicker:function(){var t=this,i=e('<input id="'+t._zoneTitleId+'"/>').appendTo(t.wrapper);t._zoneTitle=new _.ui.DropDownList(i,{dataSource:_.timezone.zones_titles,dataValueField:"other_zone",dataTextField:"name",optionLabel:t.options.optionLabel,cascade:function(){this.value()||t._zone.wrapper.hide()}})},_zonePicker:function(){var t=this,i=e("<input />").appendTo(this.wrapper);t._zone=new _.ui.DropDownList(i,{dataValueField:"zone",dataTextField:"territory",dataSource:t._zonesQuery.data,cascadeFrom:t._zoneTitleId,cascade:function(){t._value=this.value(),t.trigger("change")},dataBound:function(){t._value=this.value(),this.wrapper.toggle(this.dataSource.view().length>1)}}),t._zone.wrapper.hide()},destroy:function(){b.fn.destroy.call(this),this._moveDraggable&&this._moveDraggable.destroy(),this._resizeDraggable&&this._resizeDraggable.destroy(),_.destroy(this.wrapper)},value:function(e){var i,n=this;return e===t?n._value:(i=n._zonesQuery.filter({field:"zone",operator:"eq",value:e}).data[0],i?(n._zoneTitle.value(i.other_zone),n._zone.value(i.zone)):n._zoneTitle.value(""),t)}}),D.plugin(g)}(window.kendo.jQuery)})}("function"==typeof define&&define.amd?define:function(e,t){return t()});