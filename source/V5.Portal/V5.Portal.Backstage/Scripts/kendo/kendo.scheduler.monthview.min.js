/*
* Kendo UI Complete v2013.2.918 (http://kendoui.com)
* Copyright 2013 Telerik AD. All rights reserved.
*
* Kendo UI Complete commercial licenses may be obtained at
* https://www.kendoui.com/purchase/license-agreement/kendo-ui-complete-commercial.aspx
* If you do not own a commercial license, this file shall be governed by the trial license terms.
*/
!function(define){return define(["./kendo.scheduler.view.min"],function(){!function(t){function e(t,e){return t.slice(e).concat(t.slice(0,e))}function n(t,e){for(var n=e.firstDay,s=new Date(t.getFullYear(),t.getMonth(),0,t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds());s.getDay()!=n;)i.date.setTime(s,-1*h);return s}function s(t,e,n){var s,i=e.getTime(),r=n.getTime();return s=t.getTime(),s>=i&&r>=s}var i=window.kendo,r=i.ui,o=r.SchedulerView,a=".kendoMonthView",l=t.extend,d=t.proxy,u=i.date.getDate,h=i.date.MS_PER_DAY,c=6,f=7,p=i.template('<span class="k-link k-nav-day">#:kendo.toString(date, "dd")#</span>'),v='<div role="gridcell" aria-selected="false" data-#=ns#uid="#=uid#"#if (resources[0]) { #style="background-color:#=resources[0].color #; border-color: #=resources[0].color#"class="k-event#=inverseColor ? " k-event-inverse" : ""#"#} else {#class="k-event"#}#><span class="k-event-actions"># if(data.tail || data.middle) {#<span class="k-icon k-i-arrow-w"></span>#}## if(data.isException()) {#<span class="k-icon k-i-exception"></span># } else if(data.isRecurring()) {#<span class="k-icon k-i-refresh"></span>#}#</span>{0}<span class="k-event-actions">#if (showDelete) {#<a href="\\#" class="k-link k-event-delete"><span class="k-icon k-si-close"></span></a>#}## if(data.head || data.middle) {#<span class="k-icon k-i-arrow-e"></span>#}#</span># if(resizable && !data.tail && !data.middle) {#<span class="k-resize-handle k-resize-w"></span>#}## if(resizable && !data.head && !data.middle) {#<span class="k-resize-handle k-resize-e"></span>#}#</div>',g=i.template('<div title="#=title.replace(/"/g,"&\\#34;")#"><div class="k-event-template">#:title#</div></div>'),_=i.template('<div style="width:#=width#px;left:#=left#px;top:#=top#px" class="k-more-events k-button"><span>...</span></div>');r.MonthView=o.extend({init:function(t,e){var n=this;o.fn.init.call(n,t,e),n.title=n.options.title,n.name="month",n._templates(),n._editable(),n._renderLayout(n.options.date),n._groups()},_updateDirection:function(t,e,n,s,i){var r,o,a,l,d;n&&(r=e[0].start,o=e[e.length-1].end,a=r.index===o.index,l=r.collectionIndex===o.collectionIndex,d=i?a&&l||l:a&&l,d&&(t.backward=s))},_changeViewPeriod:function(t,e,n){var s=n?7:1;return e&&(s*=-1),t.start=i.date.addDays(t.start,s),t.end=i.date.addDays(t.end,s),(!n||n&&this._isVerticallyGrouped())&&(t.groupIndex=e?this.groups.length-1:0),t.events=[],!0},_continuousSlot:function(t,e,n){var s=t.backward?0:e.length-1,i=this.groups[t.groupIndex];return i.continuousSlot(e[s].start,n)},_changeGroupContinuously:function(t,e,n,s){var i,r,o,a;return n||(i=t.groupIndex,r=this.groups.length-1,o=this._isVerticallyGrouped(),a=this.groups[i],!e&&o?(e=a[s?"lastSlot":"firstSlot"](),i+=s?-1:1):e&&!o&&(i=s?r:0),(0>i||i>r)&&(i=s?r:0,e=null),t.groupIndex=i),e},_normalizeHorizontalSelection:function(t,e,n){var s;return s=n?e[0].start:e[e.length-1].end},_normalizeVerticalSelection:function(t,e){var n;return n=t.backward?e[0].start:e[e.length-1].end},_templates:function(){var t=this.options,e=l({},i.Template,t.templateSettings);this.eventTemplate=this._eventTmpl(t.eventTemplate),this.dayTemplate=i.template(t.dayTemplate,e)},dateForTitle:function(){return i.format(this.options.selectedDateFormat,this._firstDayOfMonth,this._lastDayOfMonth)},nextDate:function(){return i.date.nextDay(this._lastDayOfMonth)},previousDate:function(){return i.date.previousDay(this._firstDayOfMonth)},startDate:function(){return this._startDate},endDate:function(){return this._endDate},_renderLayout:function(e){var s=this;this._firstDayOfMonth=i.date.firstDayOfMonth(e),this._lastDayOfMonth=i.date.lastDayOfMonth(e),this._startDate=n(e,this.calendarInfo()),this.createLayout(this._layout()),this.table.addClass("k-scheduler-monthview"),this._content(),this.refreshLayout(),this.content.on("click"+a,".k-nav-day,.k-more-events",function(e){var n=t(e.currentTarget).offset(),i=s._slotByPosition(n.left,n.top);e.preventDefault(),s.trigger("navigate",{view:"day",date:i.startDate()})})},_editable:function(){this.options.editable&&(i.support.mobileOS?this._touchEditable():this._mouseEditable())},_mouseEditable:function(){var e=this;e.element.on("click"+a,".k-scheduler-monthview .k-event a:has(.k-si-close)",function(n){e.trigger("remove",{uid:t(this).closest(".k-event").attr(i.attr("uid"))}),n.preventDefault()}),e.options.editable.create!==!1&&e.element.on("dblclick"+a,".k-scheduler-monthview .k-scheduler-content td",function(n){var s=t(n.currentTarget).offset(),i=e._slotByPosition(s.left,s.top),r=e._resourceBySlot(i);e.trigger("add",{eventInfo:l({isAllDay:!0,start:i.startDate(),end:i.startDate()},r)}),n.preventDefault()}),e.options.editable.update!==!1&&e.element.on("dblclick"+a,".k-scheduler-monthview .k-event",function(n){e.trigger("edit",{uid:t(this).closest(".k-event").attr(i.attr("uid"))}),n.preventDefault()})},_touchEditable:function(){var e=this;e._closeUserEvents=new i.UserEvents(e.element,{filter:".k-scheduler-monthview .k-event a:has(.k-si-close)",tap:function(n){e.trigger("remove",{uid:t(n.target).closest(".k-event").attr(i.attr("uid"))}),n.preventDefault()}}),e.options.editable.create!==!1&&(e._addUserEvents=new i.UserEvents(e.element,{filter:".k-scheduler-monthview .k-scheduler-content td",tap:function(n){var s=t(n.target).offset(),i=e._slotByPosition(s.left,s.top),r=e._resourceBySlot(i);e.trigger("add",{eventInfo:l({isAllDay:!0,start:i.startDate(),end:i.endDate()},r)}),n.preventDefault()}})),e.options.editable.update!==!1&&(e._editUserEvents=new i.UserEvents(e.element,{filter:".k-scheduler-monthview .k-event.k-state-selected",tap:function(n){0===t(n.event.target).closest("a:has(.k-si-close)").length&&(e.trigger("edit",{uid:t(n.target).closest(".k-event").attr(i.attr("uid"))}),n.preventDefault())}}))},selectionByElement:function(e){var n=t(e).offset();return this._slotByPosition(n.left,n.top)},_columnCountForLevel:function(t){var e=this.columnLevels[t];return e?e.length:0},_rowCountForLevel:function(t){var e=this.rowLevels[t];return e?e.length:0},_content:function(){var t,e="<tbody>",n=1,s=this.groupedResources;for(s.length&&this._isVerticallyGrouped()&&(n=this._rowCountForLevel(s.length-1)),t=0;n>t;t++)e+=this._createCalendar();e+="</tbody>",this.content.find("table").html(e)},_createCalendar:function(){var t,e,n,s=this.startDate(),r=f*c,o=f,a=[s],l="",d=1,u=this.groupedResources;for(u.length&&(this._isVerticallyGrouped()||(d=this._columnCountForLevel(u.length-1))),this._slotIndices={},t=0;r/o>t;t++){for(l+="<tr>",a.push(s),e=t*o,n=0;d>n;n++)l+=this._createRow(s,e,o);s=i.date.addDays(s,o),l+="</tr>"}return this._weekStartDates=a,this._endDate=i.date.previousDay(s),l},_createRow:function(t,e,n){var s,r=this._firstDayOfMonth,o=this._lastDayOfMonth,a=this.dayTemplate,l="",d="";for(s=0;n>s;s++)l="",i.date.isToday(t)&&(l+="k-today"),i.date.isInDateRange(t,r,o)||(l+=" k-other-month"),d+="<td ",""!==l&&(d+='class="'+l+'"'),d+=">",d+=a({date:t}),d+="</td>",this._slotIndices[u(t).getTime()]=e+s,t=i.date.nextDay(t);return d},_layout:function(){var n,s,i,r=this.calendarInfo(),o=e(r.days.names,r.firstDay),a=t.map(o,function(t){return{text:t}}),l=this.groupedResources;if(l.length)if(this._isVerticallyGrouped()){for(s=[],i=0;6>i;i++)s.push({text:"<div>&nbsp;</div>",className:"k-hidden k-slot-cell"});n=this._createRowsLayout(l,s)}else a=this._createColumnsLayout(l,a);return{columns:a,rows:n}},_eventTmpl:function(t){var e,n=this.options,s=l({},i.Template,n.templateSettings),r=s.paramName,o="",a=typeof t,u={storage:{},count:0};return"function"===a?(u.storage["tmpl"+u.count]=t,o+="#=this.tmpl"+u.count+"("+r+")#",u.count++):"string"===a&&(o+=t),e=i.template(i.format(v,o),s),u.count>0&&(e=d(e,u.storage)),e},_createEventElement:function(e){var n=this.options,s=n.editable;return e.showDelete=s&&s.destroy!==!1,e.resizable=s&&s.resize!==!1,e.ns=i.ns,e.resources=this.eventResources(e),e.inverseColor=e.resources&&e.resources[0]?this._shouldInverseResourceColor(e.resources[0]):!1,t(this.eventTemplate(e))},_isInDateSlot:function(t){var e=this.startDate(),n=new Date(this.endDate().getTime()+h-1);return s(t.start,e,n)||s(t.end,e,n)||s(e,t.start,t.end)||s(n,t.start,t.end)},_slotIndex:function(t){return this._slotIndices[u(t).getTime()]},_positionEvent:function(e,n,s){var r,a,l,d,u,h,c,f,p,v,g,m,y,k,D,w=this.options.eventHeight,b=e.start;for(e.start.offsetLeft>e.end.offsetLeft&&(b=e.end),r=e.start.index,a=e.end.index,l=b.eventCount,d=o.collidingEvents(e.events(),r,a),u=r!==a?5:4,d.push({element:n,start:r,end:a}),h=o.createRows(d),c=0,f=Math.min(h.length,l);f>c;c++)for(p=h[c].events,v=b.offsetTop+b.firstChildHeight+c*w+3*c+"px",g=0,m=p.length;m>g;g++)p[g].element[0].style.top=v;if(h.length>l)for(y=r;a>=y;y++){if(k=e.collection,D=k.at(y),D.more)return;D.more=t(_({ns:i.ns,start:y,end:y,width:D.clientWidth-2,left:this._scrollbarOffset(D.offsetLeft+2),top:D.offsetTop+D.firstChildHeight+l*w+3*l})),this.content[0].appendChild(D.more[0])}else e.addEvent({element:n,start:r,end:a,groupIndex:b.groupIndex}),n[0].style.width=e.innerWidth()-u+"px",n[0].style.left=this._scrollbarOffset(b.offsetLeft+2)+"px",n[0].style.height=w+"px",s._continuousEvents.push({element:n,uid:n.attr(i.attr("uid")),start:e.start,end:e.end}),this.content[0].appendChild(n[0])},_slotByPosition:function(t,e){var n,s,i=this.content.offset();for(t-=i.left,e-=i.top,e+=this.content[0].scrollTop,t+=this.content[0].scrollLeft,t=Math.ceil(t),e=Math.ceil(e),n=0;n<this.groups.length;n++)if(s=this.groups[n].daySlotByPosition(t,e))return s;return null},_createResizeHint:function(t){var e,n,s,i,r=t.startSlot().offsetLeft;r=this._scrollbarOffset(r),e=t.start.offsetTop,n=t.innerWidth(),s=t.start.clientHeight-2,i=o.fn._createResizeHint.call(this,r,e,n,s),i.appendTo(this.content),this._resizeHint=this._resizeHint.add(i)},_updateResizeHint:function(t,e,n){var s,r,o;for(this._removeResizeHint(),s=this.groups[n.groupIndex],r=s.ranges(e.startDate(),t.isAllDay?n.startDate():n.endDate(),!0,t.isAllDay),o=0;o<r.length;o++)this._createResizeHint(r[o]);this._resizeHint.find(".k-label-top,.k-label-bottom").text(""),this._resizeHint.first().addClass("k-first").find(".k-label-top").text(i.toString(e.startDate(),"M/dd")),this._resizeHint.last().addClass("k-last").find(".k-label-bottom").text(i.toString(n.startDate(),"M/dd"))},_updateMoveHint:function(t,e,n){var s,r,o,a,l,d=n.start-e.start,u=i.date.toUtcTime(t.start)+d,h=u+t.duration(),c=this.groups[n.groupIndex],f=c.ranges(u,h,!0,t.isAllDay);for(this._removeMoveHint(),s=0;s<f.length;s++)r=f[s],o=r.startSlot(),a=r.endSlot(),l=this._createEventElement(t.clone({head:r.head,tail:r.tail})),l.css({left:o.offsetLeft+2,top:o.offsetTop+o.firstChildHeight,height:this.options.eventHeight,width:r.innerWidth()-(o.index!==a.index?5:4)}),l.addClass("k-event-drag-hint"),l.appendTo(this.content),this._moveHint=this._moveHint.add(l)},_groups:function(){var t,e,n,s,r,o,a,l,d,u,h,p,v,g,_,m,y,k=this._groupCount(),D=f,w=c;for(this.groups=[],t=0;k>t;t++)this._addResourceView(t);for(e=this.content[0].getElementsByTagName("tr"),n=0;k>n;n++)for(s=0,r=0,this._isVerticallyGrouped()&&(r=n),o=r*w;(r+1)*w>o;o++)for(a=this.groups[n],l=a.addDaySlotCollection(i.date.addDays(this.startDate(),s),i.date.addDays(this.startDate(),s+D)),d=e[o],u=d.children,h=0,d.setAttribute("role","row"),this._isVerticallyGrouped()||(h=n),p=h*D;(h+1)*D>p;p++)v=u[p],g=v.clientHeight,_=v.firstChild.offsetHeight+3,m=i.date.toUtcTime(i.date.addDays(this.startDate(),s)),s++,y=Math.floor((g-_)/(this.options.eventHeight+3)),v.setAttribute("role","gridcell"),v.setAttribute("aria-selected",!1),l.addDaySlot(v,m,m+i.date.MS_PER_DAY,y)},render:function(t){this.content.children(".k-event,.k-more-events").remove(),this._groups(),t=new i.data.Query(t).sort([{field:"start",dir:"asc"},{field:"end",dir:"desc"}]).toArray();var e=this.groupedResources;e.length?this._renderGroups(t,e,0,1):this._renderEvents(t,0),this.refreshLayout(),this.trigger("activate")},_renderEvents:function(t,e){var n,s,i,r,o,a,l,d,u,h,c;for(s=0,i=t.length;i>s;s++)if(n=t[s],this._isInDateSlot(n))for(r=this.groups[e],r._continuousEvents||(r._continuousEvents=[]),o=r.slotRanges(n,!0),a=o.length,l=0;a>l;l++)d=o[l],u=n.start,h=n.end,a>1&&(0===l?h=d.end.endDate():l==a-1?u=d.start.startDate():(u=d.start.startDate(),h=d.end.endDate())),c=n.clone({start:u,end:h,head:d.head,tail:d.tail}),this._positionEvent(d,this._createEventElement(c),r)},_renderGroups:function(t,e,n,s){var r,a,l,d,u=e[0];if(u)for(r=u.dataSource.view(),a=0;a<r.length;a++)l=this._resourceValue(u,r[a]),d=new i.data.Query(t).filter({field:u.field,operator:o.groupEqFilter(l)}).toArray(),e.length>1?n=this._renderGroups(d,e.slice(1),n++,s+1):this._renderEvents(d,n++);return n},_groupCount:function(){var t=this.groupedResources;return t.length?this._isVerticallyGrouped()?this._rowCountForLevel(t.length-1):this._columnCountForLevel(t.length)/this._columnOffsetForResource(t.length):1},_removeOffset:function(t,e){var n,s,i,r,o=this.groupedResources,a=0;return o.length&&(this._isVerticallyGrouped()?a=f*c*e:(n=this._columnOffsetForResource(o.length),s=this._groupCount(),i=n*s,r=Math.floor(t/i),a=n*(s-1)*r,a+=n*e)),t-a},_applyOffset:function(t,e){var n,s,i=this.groupedResources,r=0,o=f,a=c;return i.length&&(this._isVerticallyGrouped()?r=o*a*e:(n=Math.floor(t/o),s=this._columnOffsetForResource(i.length),r=s*(this._groupCount()-1)*n,r+=s*e)),t+r},_groupIndex:function(t){var e,n,s,i,r,o=this.groupedResources;return o.length?this._isVerticallyGrouped()?Math.floor(t/(f*c)):(e=this._columnOffsetForResource(o.length),n=this._groupCount(),s=e*n,i=Math.floor(t/s),r=e*n*i,Math.floor((t-r)/e)):0},_columnOffsetForResource:function(t){return this._columnCountForLevel(t)/this._columnCountForLevel(t-1)},destroy:function(){this.table&&this.table.removeClass("k-scheduler-monthview"),this.content&&this.content.off(a),this.element&&this.element.off(a),o.fn.destroy.call(this),i.support.mobileOS&&(this._closeUserEvents.destroy(),this.options.editable.create!==!1&&this._addUserEvents.destroy(),this.options.editable.update!==!1&&this._editUserEvents.destroy())},events:["remove","add","edit","navigate"],options:{title:"Month",name:"month",eventHeight:25,editable:!0,selectedDateFormat:"{0:y}",dayTemplate:p,eventTemplate:g}})}(window.kendo.jQuery)})}("function"==typeof define&&define.amd?define:function(t,e){return e()});