@model V5.Portal.Models.OrderInfoViewModel
@{
    ViewBag.Title = "订单提交 - 购酒网";
    Layout = null;
    var url = "/Home/Item?ID=";
    var totalMoney = 0.0;
}
<link rel="stylesheet" href="../../Content/Order/cloud.css">
<link rel="stylesheet" href="../../Content/Order/v4_cart.css">
<link href="../../Content/Order/jquery.css" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="../../Content/Order/cloud_002.css">
<link rel="stylesheet" href="../../Content/Order/jScrollPane.css">
<script src="../../Scripts/jquery-1.7.1.min.js"></script>
<script src="../../Scripts/Order/rt.js" async="" type="text/javascript"></script>
<script src="../../Scripts/Order/jquery_002.js" async="" type="text/javascript"></script>
<script src="../../Scripts/ga.js" async="" type="text/javascript"></script>
<script src="../../Scripts/global.js" type="text/javascript"></script>
<script type="text/javascript" src="../../Scripts/Order/jScrollPane.js"></script>
    <!--头部-->
    
<div id="head">
    <!--logo-->
    <div class="logo png-pic">
        <a href="http://v4.gjw.com/" title="购酒网 - 首页"></a>
    </div>
    <div id="head_right">
        <ul class="head_user">
            
                <li><span>欢迎来到购酒网!&nbsp;&nbsp;<strong>连印
                </strong>!</span>&nbsp;&nbsp;<a href="http://v4.gjw.com/login/Exit.htm">退出登录</a>&nbsp;&nbsp;</li>
            
            
            <li><a href="http://v4.gjw.com/user/MyOrder.htm">我的订单</a></li>
            <li>|</li>
            <li id="mypop"><a href="http://v4.gjw.com/user/" id="myquwan">用户中心</a>
                <div id="my_pop">
                <a href="http://v4.gjw.com/user/MyComment.htm">商品评论</a>
                <a href="http://v4.gjw.com/user/MyFav.htm"> 我的收藏</a>
                <a href="http://v4.gjw.com/user/MyVoucher.htm">我的电子券</a> 
                </div>
            </li>
            <li>|</li>
            <li><a href="http://v4.gjw.com/help/show.htm" target="_blank">帮助中心</a></li>
        </ul>
        <div id="head_other">
            您在购物过程中有任何疑问，请查阅<a class="blue" href="http://v4.gjw.com/help/show.htm" target="_blank">帮助中心</a>，或致电<span class="tel400">400-722-1919</span>
        </div>
    </div>
    <div class="clear">
    </div>
</div>

<!--头部-->
<!--主体-->
<div id="global_body">
<div id="step_2" class="step_box">
</div>
<dl class="cinfo_box">
<dt><b>收货人信息</b><a id="addr_modify" class="blue" style="display: none;">[修改]</a></dt>
<dd id="addr_editbox" class="cinfo_on">
    <div class="addr_list" style="display: block;">
        <!--addr_list-->
        <h1 class="cinfo_subt">
            常用地址</h1>
        <ul id="old_addr_selec">
            @{
                if (Model != null && Model.UserReceiveAddressList != null)
                {
                    foreach (var item in Model.UserReceiveAddressList)
                    {
                        <li class="k100 addr_off fl addr_on">
                            <p class="k85 fl ChangAddr">
                                @if (item.IsDefault)
                                {
                                    <input name="addr" checked="checked" index="@Html.Raw(item.ID)" value="@Html.Raw(item.ID)" type="radio" />
                                }
                                else
                                {
                                    <input name="addr" index="@Html.Raw(item.ID)" value="@Html.Raw(item.ID)" type="radio" />
                                }
                                
                                <span>
                                    @item.Consignee</span> <span>
                                                               @item.CountyName("-")-@item.Address-@item.Mobile</span>
                            </p>
                            <span class="fl"><a href="javascript:;" class="mr20 EditAddr">编辑</a> <a href="javascript:;" class="mr20 DelAddr">删除</a> </span>
                        </li>
                    }
                }
            }
            
                            
            <li class="addr_off">
                <p>
                    <input id="addr_new" name="addr" type="radio">
                    <input name="TypeID" id="TypeID" value="0" type="hidden">
                    <label for="addr_new">
                        使用新地址</label>
                </p>
            </li>
        </ul>
    </div>
    <div id="addr_edit_table" style="display: none;">
        <div class="addr_div">
            <ul>
                <li class="addr_tdiv">收货人姓名：</li>
                <li>
                    <input maxlength="20" size="20" id="consignee" class="info_input" name="consignee" type="text">
                </li>
                <li><font>*</font></li>
                <li><span style="display: none;" class="yhq_tip">请填写收货人姓名！</span> </li>
            </ul>
            <div class="clear">
            </div>
            <ul>
                <li class="addr_tdiv">所在城市：</li>
                <li>
                    <select name="drpProvince" id="drpProvince">
	<option selected="selected" value="">请选择</option>
	<option value="9">上海</option>
	<option value="1">北京</option>
	<option value="19">广东</option>
	<option value="10">江苏</option>
	<option value="11">浙江</option>
	<option value="23">四川</option>
	<option value="22">重庆</option>
	<option value="2">天津</option>
	<option value="13">福建</option>
	<option value="15">山东</option>
	<option value="12">安徽</option>
	<option value="17">湖北</option>
	<option value="18">湖南</option>
	<option value="16">河南</option>
	<option value="28">甘肃</option>
	<option value="20">广西</option>
	<option value="24">贵州</option>
	<option value="21">海南</option>
	<option value="3">河北</option>
	<option value="8">黑龙江</option>
	<option value="7">吉林</option>
	<option value="14">江西</option>
	<option value="6">辽宁</option>
	<option value="5">内蒙古</option>
	<option value="30">宁夏</option>
	<option value="29">青海</option>
	<option value="4">山西</option>
	<option value="27">陕西</option>
	<option value="26">西藏</option>
	<option value="31">新疆</option>
	<option value="25">云南</option>
</select>
                            </li>
                            <li>
                                <select name="drpCity" id="drpCity">
	<option selected="selected" value="">请选择</option>
</select>
                            </li>
                            <li>
                                <select name="drpCounty" id="drpCounty">
	<option selected="selected" value="">请选择</option>
</select>
                            </li>
                            <li><span style="display: none;" class="yhq_tip">请选择所在城市！</span> </li>
                        </ul>
                        <div class="clear">
                        </div>
                        <ul>
                            <li class="addr_tdiv">详细地址：</li>
                            <li>
                                <input maxlength="50" size="78" id="address" class="info_input" name="address" type="text">
                            </li>
                            <li><font>*</font></li>
                            <li><span style="display: none;" class="yhq_tip">请填写详细地址！</span> </li>
                        </ul>
                        <div class="clear">
                        </div>
                        <ul>
                            <li class="addr_tdiv">手机号码：</li>
                            <li>
                                <input maxlength="11" size="20" id="mobile" class="info_input" name="mobile" type="text">
                            </li>
                            <li><span style="line-height: 27px;">固定电话：</span> </li>
                            <li>
                                <input maxlength="13" size="20" id="tel" class="info_input" name="tel" type="text">
                            </li>
                            <li><font>*</font></li>
                            <li><span style="display: none;" class="yhq_tip">手机和固定电话至少填写一项！</span></li>
                        </ul>
                        <div class="clear">
                        </div>
                        <ul id="addr_btnul">
                            <li class="addr_tdiv">&nbsp;</li>
                            <li>
                                <!--<a id="addr_btn" class="cbtn addr_btn">确认收货人信息</a>-->
                                系统将自动保存您这一次填写的收货地址</li>
                            <!--<li><a id="addr_cbtn" class="cbtn addr_cbtn">取消</a></li>-->
                        </ul>
                        <div class="clear">
                        </div>
                    </div>
                </div>
            </dd>
        </dl>
        <dl class="cinfo_box">
            <dt id="wp_title"><b>支付方式</b><a id="payment_modify" class="blue" style="display: none;">[修改]</a></dt>
            <dd id="payment_okbox" class="cinfo_off" style="display: none;">
                <table class="cinfo_tab" border="0" cellpadding="0" cellspacing="0" width="100%">
                    <tbody>
                        <tr>
                            <td align="right" valign="middle" width="10%">
                                <span>配送方式：</span>
                            </td>
                            <td align="left" valign="middle" width="88%">
                                <p>
                                    快递</p>
                            </td>
                        </tr>
                        <tr>
                            <td align="right" valign="middle">
                                <span>付款方式：</span>
                            </td>
                            <td align="left" valign="middle">
                                <p>
                                    支付宝</p>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </dd>
            <dd id="shipping_payment_editbox" class="cinfo_on fix">
                <div class="">
                    <h4>
                        1.在线支付：</h4>
                    <p class="c6 mt10 mb10 pl20">
                        支付平台：</p>
                    <ul id="inlinePay" class="fix pl20 w100">
                        <li class="fl mr10 mb10 w170" title="支付宝" index="4">
                            <input name="bank" id="ZhiFuBao" class="vm mr5" type="radio"><label for="ZhiFuBao" class="dib vm cart_bank u1010"></label></li>
                        <li class="fl mr10 mb10 w170" title="快钱支付" index="7">
                            <input name="bank" id="KuaiQian" class="vm mr5" type="radio"><label for="KuaiQian" class="dib vm cart_bank u1015"></label></li>
                        <li class="fl mr10 mb10 w170" title="财付通" index="5">
                            <input name="bank" id="CaiFuTong" class="vm mr5" type="radio"><label for="CaiFuTong" class="dib vm cart_bank u015"></label></li>
                    </ul>
                    <p class="c6 mt15 pl20 mb15">
                        国内银行卡或信用卡： 如果您支付所用的银行卡不在以下银行中，可选择支付平台付费，目前支付平台支持中国100多家银行在线支付业务。</p>
                    <div class="fix">
                        <ul id="setBankList" class="fl pl20 cart_bank_box">
                            <li class="fl mr10 mb10 w170" title="工商银行" index="8">
                                <input name="bank" id="GongShang" class="vm mr5" type="radio"><label for="GongShang" class="dib vm cart_bank"></label></li>
                            <li class="fl mr10 mb10 w170" title="建设银行" index="11">
                                <input name="bank" id="JianShe" class="vm mr5" type="radio"><label for="JianShe" class="dib vm cart_bank u60"></label></li>
                            <li class="fl mr10 mb10 w170" title="招商银行" index="9">
                                <input name="bank" id="ZhapShang" class="vm mr5" type="radio"><label for="ZhapShang" class="dib vm cart_bank u20"></label></li>
                            <li class="fl mr10 mb10 w170" title="中国银行" index="10">
                                <input name="bank" id="ZhongGuo" class="vm mr5" type="radio"><label for="ZhongGuo" class="dib vm cart_bank u40"></label></li>
                            <li class="fl mr10 mb10 w170" title="农业银行" index="12">
                                <input name="bank" id="NongYe" class="vm mr5" type="radio"><label for="NongYe" class="dib vm cart_bank u80"></label></li>
                            <li class="fl mr10 mb10 w170" title="交通银行" index="15">
                                <input name="bank" id="JiaoTong" class="vm mr5" type="radio"><label for="JiaoTong" class="dib vm cart_bank u05"></label></li>
                            <li class="fl mr10 mb10 w170" title="广发银行" index="17">
                                <input name="bank" id="GuangFa" class="vm mr5" type="radio"><label for="GuangFa" class="dib vm cart_bank u45"></label></li>
                            <li class="fl mr10 mb10 w170" title="浦发银行" index="16">
                                <input name="bank" id="PuFa" class="vm mr5" type="radio"><label for="PuFa" class="dib vm cart_bank u25"></label></li>
                            <li class="fl mr10 mb10 w170" title="兴业银行" index="20">
                                <input name="bank" id="XingYe" class="vm mr5" type="radio"><label for="XingYe" class="dib vm cart_bank u105"></label></li>
                            <li class="fl mr10 mb10 w170" title="中信银行" index="19">
                                <input name="bank" id="ZhongXing" class="vm mr5" type="radio"><label for="ZhongXing" class="dib vm cart_bank u85"></label></li>
                            <li class="fl mr10 mb10 w170" title="民生银行" index="13">
                                <input name="bank" id="MinSheng" class="vm mr5" type="radio"><label for="MinSheng" class="dib vm cart_bank u100"></label></li>
                        </ul>
                    </div>
                    
                        <h4>
                            2.货到付款：</h4>
                        <ul id="codPay" class="fix pl20 mt10">
                            <li class="fl mr20" title="现金支付" index="1">
                                <input name="bank" id="cash" class="vm mr5" checked="checked" type="radio"><label for="cash">现金支付</label></li>
                            <li class="fl" title="POS机刷卡" index="2">
                                <input name="bank" id="pos" class="vm mr5" type="radio"><label for="pos">POS机刷卡</label>(<a href="http://v4.gjw.com/help/show-id-7.htm" class="cd5" target="_blank">购酒网支持的货到付款及货到刷卡地区</a>)</li>
                        </ul>
                    
                </div>
            </dd>
        </dl>
        <dl class="cinfo_box">
            <dt><b>商品清单</b><a class="blue" href="http://v4.gjw.com/purchase/ShoppingCart.htm">&lt;&lt;返回购物车修改</a></dt>
            <dd style="border-bottom: 1px solid #eaeaea;" class="cinfo_off">
                <dl style="border: 1px solid #eaeaea;" class="cart_box">
                    <div style="padding-left: 14px; color: #999; border-bottom: 1px solid #eaeaea; text-align: center;
                        height: 31px; line-height: 31px;">
                        <span class="fl cb_rr1">商品</span><span class="fl cb_rr2">单价</span><span class="fl cb_rr3">数量</span><span class="fl cb_rr4">小计</span>
                        <div class="clear">
                        </div>
                    </div>
                    <dd style="padding-top: 0;">
                        @{
                            if (Model != null && Model.Products!=null)
                            {
                                foreach(var item in Model.Products)
                                {
                                    <table id="goods_29852_0_0_0" border="0" cellpadding="0" cellspacing="0" width="100%">
                                    <tbody>
                                        <tr>
                                            <td class="cb_r11 zp_td">
                                                <a href="@Html.Raw(url + item.ProductID)" target="_blank">
                                                    <img src="@Html.Raw(item.ProductPic)" title="@Html.Raw(item.ProductName)" height="50" width="50"></a>
                                            </td>
                                            <td class="cb_r12 zp_td">
                                                <a class="blue" href="@Html.Raw(url + item.ProductID)" target="_blank">
                                                    @item.ProductName</a><br>
                                                
                                            </td>
                                            <td class="cb_r13 zp_td" align="center">
                                            </td>
                                            <td class="cb_r8 zp_td" align="center">
                                                ¥@item.GoujiuPrice</td>
                                            <td class="cb_r4 zp_td" align="center">
                                                @item.Quantity
                                            </td>
                                            <td class="cb_r5 zp_td" align="center">
                                                <span><b id="subtotal_29852_0_0_0">¥@(item.Quantity * @item.GoujiuPrice)</b></span></td>
                                        </tr>
                                    </tbody>
                                </table>
                                totalMoney += item.Quantity * @item.GoujiuPrice;
                                }
                            }
                         }
                            
                        
                    </dd>
                </dl>
                <div class="fix mt10">
                    <div class="fl">
                        <p class="mb5 cartCash">
                            <strong class="c9d dib cur"><span class="ico_tag ico_add"></span>电子券抵扣</strong></p>
                        <div style="display: none;" class="p10 bddc bggray mb5 cartCashCon">
                            <div id="coupon" class="scroll-pane">
                                
                                
                            </div>
                            <div class="clear"></div>
                           <div style="display: none;" class="chb"><input id="chb" type="checkbox"><label for="chb">显示更多（展开）</label></div>
                           <div class="clear"></div>
                            <div id="cashCoupon" class="cart_dot pt5">
                                <p class="mb5 c6">
                                    使用新的电子券(<a target="_blank" href="http://v4.gjw.com/User/MyVoucher.htm" class="cd5">查看我的电子券</a>)</p>
                                <p class="cart_tip p10">
                                    <label for="">
                                        卡号：</label><input id="txtNumber" name="txtNumber" maxlength="30" class="input w140 vm" type="text">
                                    <label for="">
                                        密码：</label><input id="txtPassword" name="txtPassword" maxlength="20" class="input w140 vm" type="text">
                                    <a id="checkedCash" href="javascript:" class="btn tdn vm c3"><i class="line bgyellow">
                                    </i><span class="yellow_btn pl5 pr5 cur">验证电子券</span> <i class="line bgyellow"></i>
                                    </a><span class="voucher_s_tip" style="display: none;"></span>
                                </p>
                            </div>
                            <p style="display: none;" class="mb5 c6">
                                提示：电子券抵扣和积分抵扣不能同时使用。</p>
                        </div>
                        <!--积分抵扣-->
                        <!--<p class="mb5 cartCash"><strong class="c9d dib cur"><span class="fs14 mr5">+</span>积分抵扣</strong></p>
                <div class="p10 bddc bggray mb5 cartCashCon" style="display:none;">
                	<p id="integral" class="mb5">
                    	本次使用 <input type="text" class="w40 input" maxlength="4" /> 
                        积分，可抵扣 <strong class="cd5">0</strong> 元
                        <a href="javascript:" class="btn tdn vm c3">
                            <i class="line bgyellow"></i>
                            <span class="yellow_btn pl10 pr10 cur">使 用</span>
                            <i class="line bgyellow"></i>
                        </a>
                    </p>
                    <p class="c6">你有0积分，本次最多可以使用500分（100分 = 1元）</p>
                </div>-->

                <p class="mb5 cartCash"><strong class="c9d dib cur"><span class="ico_tag ico_add"></span>账户余额支付</strong></p>
                <div style="display: none;" class="p10 bddc bggray mb5 cartCashCon">
                	<p class="balance"><input name="txtAccount" id="txtAccount" class="input w80 vm" maxlength="5" type="text"> 余额支付(账户余额：<span id="spAccount">0</span>元) <span id="spOk" style="display:none;">&nbsp;已成功冲抵&nbsp;</span><a class="red cur" id="AOk" style="text-decoration:none;">使用</a><a class="red cur" id="ARest" style="display:none; cursor:pointer;text-decoration:none;">取消使用</a></p>
                </div>
                       <p class="mb5 cartCash">
                            <strong class="c9d dib cur"><span class="ico_tag ico_add"></span>附加说明</strong></p>
                        <div style="display: none;" class="p10 bddc bggray mb5 cartCashCon">
                            <textarea class="pct90 textarea c6 fs12" id="txtIntro">请勿再次输入有关配送地址、支付方式、发票信息等信息。谢谢！</textarea>
                        </div>
                        <p class="mb5 cartCash">
                            <strong class="c9d dib cur"><span class="ico_tag ico_add"></span>开发票</strong></p>
                        <div style="display: none;" class="p10 bddc bggray mb5 cartCashCon">
                            发票抬头：<input class="w200 input mr10" id="txtInvoiceTitle" type="text">
                            发票内容：
                            <select id="drpInvoiceType">
                                <option selected="selected" value="3">酒</option>
                                <option value="6">饮料</option>
                                <option value="7">食品</option>
                                <option value="0">本品</option>
                            </select>
                        </div>
                    </div>
                    <div id="setAmount" class="cell lh22">
                        <p class="tr pr5 red fwb">
                            商品金额共计：¥
                            <label id="lbSumProMoney" class="fwb">@totalMoney</label></p>
                        <p class="tr pr5">
                            运费：¥
                            <label id="lbFreight">0</label></p>
                        <p class="tr pr5 red fwb">
                            电子券抵扣：¥ -<label id="lbVoucherMoney" class="fwb">0</label></p>
                        <p class="tr pr5">
                            账户余额抵扣：¥ -<label id="lbAccount">0</label></p>
                        <!--<p class="tr pr5">积分抵扣：¥ -0</p>-->
                        <p class="tr pr5">
                            满额即减优惠：¥ -<label id="lbSumReductionMoney">0</label></p>
                        <p class="tr pr5">
                            组合优惠：¥ -<label id="lbCombinationMoney">0</label></p>
                        <p class="tr pr5 mt10">
                            <strong class="cd5 fw fwb fs16 pl5 pt5 btd6">您共需要为订单支付：¥ <em id="SumMoney" class="fs22">@totalMoney</em>  
                            </strong>
                        </p>
                    </div>
                </div>
            </dd>
        </dl>
        <dl class="cart_btn">
            <dt>
                <a class="fr cbtn porder_btn" id="btnOk">提交订单</a>
                <div class="clear">
                </div>
            </dt>
            <dd>
                <!--<span class="yhq_tip">请确认收货人信息，再提交订单</span>
        <span class="yhq_tip">请确认配送与付款方式，再提交订单</span>
        <span class="yhq_tip">请确定购物凭证，再提交订单</span>-->
            </dd>
        </dl>
    </div>

<script type="text/javascript">
    //电子卷展开/收缩
    var couponHandler = function () {
        var th = $("#coupon").height();
        if ($("#coupon p").length <= 4) {
            $(".chb").css({ "display": "none" });
        } else {
            $("#coupon").css({ "height": 85 });
            $(".chb").css({ "display": "block" });
            $(".chb input").click(function () {
                if ($(this).attr("checked") == "checked") {
                    $("#coupon").animate({ "height": th });
                    $(".chb label").html("默认显示（收缩）");
                } else {
                    $("#coupon").animate({ "height": 85 });
                    $(".chb label").html("显示更多（展开）")
                }
            })
        }
    }
    couponHandler();
    //收货地址检查
    var checkAddr = function () {
        $("#consignee,#address").blur(function () {
            if ($(this).val() == "") {
                showError(this);
            } else {
                hideError(this);
            }
        });
        $("#mobile,#tel").blur(function () {
            checkNum();
        });
        function checkNum() {
            var mob = $("#mobile").val(), tel = $("#tel").val(), $this = $("#mobile");
            if (mob == "" && tel == "") {
                showError($this);
            } else {
                if (tel != "" && /^(\d{4}-)(\d{8})$|(\d{4})(\d{8})$|(\d{3}-)(\d{8})$|(\d{4}-)(\d{7})$|(\d{3})(\d{8})$|(\d{4})(\d{7})$/.test(tel)) {
                    hideError($this);
                } else if (mob != "" && /^1[3,4,5,8]\d{9}$/.test(mob)) {
                    hideError($this);
                } else {
                    showError($this);
                }
            }
        }
        function showError(obj) {
            $(obj).parents("ul").children("li:last").find("span").show();
        }
        function hideError(obj) {
            $(obj).parents("ul").children("li:last").find("span").hide();
        }
    }
    function ChangBank(BankID) {
        $.post("/ajax/Order/OrderAdd.htm?act=ChangBank", { "BankID": BankID }, function (data) {
            var json = eval(data)[0];
            if (json.Success != 1) {
                window.location = 'http://v4.gjw.com/purchase/OrderInfo.htm'
            }
        });
    }
    function DelCartPro() {
        var sender = $(this);
        $.post(
                    "/ajax/Order/OrderAdd.htm?act=DelProduct",
                    { ID: $("#hifIds").val() },
                    function (data) {
                        window.location = 'http://v4.gjw.com/purchase/OrderInfo.htm'
                    }
                )
    }
    function DelVouchers(obj) {
        $.post("/ajax/Order/Order.htm?act=VouchersCodeRest", function (data) {
            var json = eval(data)[0];
            $("#lbVoucherMoney").html(json.Message);
            //$("#SumMoney").html(parseFloat($("#lbSumProMoney").html()) + parseFloat($("#lbFreight").html()) - parseFloat(json.Message) - parseFloat($("#lbSumReductionMoney").html()));
            GetMyMoney();
            var $this = $(obj);
            var v1 = $this.parent();
            v1.remove();
        });
    }
    function GetMyMoney() {
        var SumMoney = (parseFloat($("#lbSumProMoney").html()) + parseFloat($("#lbFreight").html()) - parseFloat($("#lbVoucherMoney").html()) - parseFloat($("#lbSumReductionMoney").html()) - parseFloat($("#lbCombinationMoney").html()) - parseFloat($("#lbAccount").html())).toFixed(1);
        if (parseFloat(SumMoney) > 0) {
            $("#SumMoney").html(SumMoney);
        }
        else {
            $("#SumMoney").html("0");
        }
    }
    $(function () {
        /*市*/
        $($("#drpProvince").fillDropdown(
			    $("#drpCity"),
			    "/Ajax/NameValueList-act-GetCity.htm",
        	    { Selected: "0", Name: "请选择", Value: 0 }
		));
        /*县*/
        $($("#drpCity").fillDropdown(
			    $("#drpCounty"),
			    "/Ajax/NameValueList-act-GetCounty.htm",
        	    { Selected: "0", Name: "请选择", Value: 0 }
		 ));
        $("#drpCounty").change(function () {
            $.post("/ajax/User/UserHandle.htm?act=EditFright", { "ID": $("#drpCounty").val() }, function (data) {
                var json = eval(data)[0];
                if (json.Success == 1) {

                    var jsonAddr = eval(json.Message)[0];

                    if (jsonAddr.Cash == "0") {
                        $("#cash").attr("disabled", "disabled");
                        if ($("#cash").attr("checked")) {
                            $("#cash").removeAttr("checked");
                        }
                    }
                    else {
                        $("#cash").removeAttr("disabled");
                    }

                    if (jsonAddr.POS == "0") {
                        $("#pos").attr("disabled", "disabled");
                        if ($("#pos").attr("checked")) {
                            $("#pos").removeAttr("checked");
                        }
                    }
                    else {
                        $("#pos").removeAttr("disabled");
                    }
                    var Freight = jsonAddr.Freight;
                    $("#lbFreight").html(Freight);
                    //$("#SumMoney").html(parseFloat($("#lbSumProMoney").html()) + parseFloat(Freight) - parseFloat($("#lbVoucherMoney").html()) - parseFloat($("#lbSumReductionMoney").html()));
                    GetMyMoney();
                }
                else {
                    window.location = 'http://v4.gjw.com/purchase/OrderInfo.htm'
                }
            });
        });

        //编辑收货人信息
        $("#addr_modify").click(function () {
            $("#addr_okbox").hide();
            $("#addr_editbox").show();
            $(this).hide();
        });
        //取消编辑收货人
        $("#addr_cbtn").click(function () {
            $("#addr_editbox").hide();
            $("#addr_okbox").show();
            $("#addr_modify").show();
        });
        //编辑配送与付款方式
        $("#payment_modify").click(function () {
            $("#payment_okbox").hide();
            $("#shipping_payment_editbox").show();
            $(this).hide();
        });
        //取消编辑配送与付款方式
        $("#payway_cbtn").click(function () {
            $("#shipping_payment_editbox").hide();
            $("#payment_okbox").show();
            $("#payment_modify").show();
        });
        $("#mypop").hover(
		function () {
		    $("#my_pop").show();
		},
		function () {
		    $("#my_pop").hide();
		}
	);
        //收缩效果
        /*$("#orderMore").toggle(
        function(){
        $(this).fadeOut("1000",function(){
        $(this).children("p").text("收缩");
        $(this).appendTo($("#setBankList")).fadeIn("600");
        });
        $(this).find("u").removeClass("u016").addClass("u015");
        $("#setBankList").animate({"height":"200px"},300);
        },function(){
        $("#setBankList").animate({"height":"140px"},300);		
        $(this).find("u").removeClass("u015").addClass("u016");
        $(this).fadeOut("1000",function(){
        $(this).children("p").text("选择更多")
        $("#setBankList").find("li").eq(13).after($(this).fadeIn("600"));
        })
        }
        );*/
        /*选择支付方式*/
        var Banks = $("#setBankList").children("li").find("input");
        var codPays = $("#codPay").children("li").find("input");
        var inlinePays = $("#inlinePay").children("li").find("input");

        inlinePays.each(function () {
            $(this).click(function () {
                ChangBank($(this).parents("li").attr("index"));
                $(this).siblings("label").css("border", "2px solid #cf0404").parents("li").siblings("li").find("label").css("border", "1px solid #ccc");
                Banks.siblings("label").css("border", "1px solid #ccc");
            });
        });

        codPays.each(function () {
            $(this).click(function () {
                ChangBank($(this).parents("li").attr("index"));
                inlinePays.siblings("label").css("border", "1px solid #ccc");
                Banks.siblings("label").css("border", "1px solid #ccc");
            });
        });

        Banks.each(function () {
            $(this).click(function () {
                ChangBank($(this).parents("li").attr("index"));
                $(this).siblings("label").css("border", "2px solid #cf0404").parents("li").siblings("li").find("label").css("border", "1px solid #ccc");
                inlinePays.siblings("label").css("border", "1px solid #ccc");
            });
        });
        /*现金劵*/
        $(".cartCashCon").hide();
        $(".cartCash").toggle(function () {
            var $index = $(this).index() / 2;
            $(this).children("strong").children("span").addClass("ico_cut");
            $(".cartCashCon").eq($index).show();
        }, function () {
            var $index = $(this).index() / 2;
            $(this).children("strong").children("span").removeClass("ico_cut");
            $(".cartCashCon").eq($index).hide();
        });
        //var oCouponValues = $("#coupon").children("p");

        var oCashCoupon = $("#cashCoupon");

        //使用现金劵
        //显示取消按钮
        function fnCoupon() {
            $("#coupon").children("p").each(function () {
                var oThis = $(this).find("input:radio");
                $(this).find("input").live("click", function () {
                    var VouchersCodeID = $(this).val();
                    $.post("/ajax/Order/Order.htm?act=VouchersCode", { "ID": VouchersCodeID }, function (data) {
                        var json = eval(data)[0];
                        if (json.Success == 1) {
                            oThis.siblings("a").css("visibility", "visible");
                            $("#lbVoucherMoney").html(json.Message);
                            //$("#SumMoney").html(parseFloat($("#lbSumProMoney").html()) + parseFloat($("#lbFreight").html()) - parseFloat(json.Message) - parseFloat($("#lbSumReductionMoney").html()));
                            GetMyMoney();
                        }
                        else {
                            oThis.attr("checked", false);
                            alert(json.Message);
                            oThis.siblings("a").css("visibility", "hidden");
                        }
                    });
                    $(this).siblings("a").css("visibility", "visible").parents(".mb2").siblings("p").find("a").css("visibility", "hidden");
                });

                //取消使用
                $(this).find("a").click(function () {
                    $.post("/ajax/Order/Order.htm?act=VouchersCodeRest", function (data) {
                        var json = eval(data)[0];
                        $("#lbVoucherMoney").html(json.Message);
                        //$("#SumMoney").html(parseFloat($("#lbSumProMoney").html()) + parseFloat($("#lbFreight").html()) - parseFloat(json.Message) - parseFloat($("#lbSumReductionMoney").html()));
                        GetMyMoney();
                        oThis.attr("checked", false);
                        oThis.siblings("a").css("visibility", "hidden");
                    });
                });

            });
        }
        fnCoupon();

        //使用新地址	
        $("#addr_new").click(function () {
            $("#old_addr_selec > .addr_off").removeClass("addr_on");
            $("#consignee").val(""); $("#mobile").val(""); $("#address").val(""); $("#province").empty(); $("#city").empty(); $("#county").empty();
            $("#province").attr("name", "province3");
            $("#city").attr("name", "city3");
            $("#county").attr("name", "area3");
            $("#TypeID").val("1");
            $("#addr_edit_table").show();
        });
        //选择收货地址信息
        $(".ChangAddr").click(function () {
            $("input[name=addr]").removeAttr("checked");
            $(this).find(":radio").attr("checked", "checked");
            $(this).parents(".addr_off").addClass("addr_on").siblings(".addr_off").removeClass("addr_on");
            $("#TypeID").val("0");

//            $.post("/ajax/Order/OrderAdd.htm?act=UserChangeReceiveAddr", { "ID": $(this).find(":radio").attr("index") }, function (data) {
//                var json = eval(data)[0];
//                if (json.Success == 1) {
//                    var jsonAddr = eval(json.Message)[0];
//                    var Freight = jsonAddr.Freight;
//                    if (jsonAddr.Cash == "0") {
//                        $("#cash").attr("disabled", "disabled");
//                        if ($("#cash").attr("checked")) {
//                            $("#cash").removeAttr("checked");
//                        }
//                    }
//                    else {
//                        $("#cash").removeAttr("disabled");
//                    }

//                    if (jsonAddr.POS == "0") {
//                        $("#pos").attr("disabled", "disabled");
//                        if ($("#pos").attr("checked")) {
//                            $("#pos").removeAttr("checked");
//                        }
//                    }
//                    else {
//                        $("#pos").removeAttr("disabled");
//                    }
//                    $("#btnOk").removeAttr("disabled");

//                    $("#TypeID").val("0");
//                    $("#lbFreight").html(Freight);
//                    //$("#SumMoney").html(parseFloat($("#lbSumProMoney").html()) + parseFloat(Freight) - parseFloat($("#lbVoucherMoney").html()) - parseFloat($("#lbSumReductionMoney").html()));
//                    GetMyMoney();

//                    $("#consignee").val("");
//                    $("#address").val("");
//                    $("#mobile").val("");
//                    $("#tel").val("");
//                    $("#addr_edit_table").hide();
//                }
//                else {
//                    window.location = 'http://v4.gjw.com/purchase/OrderInfo.htm'
//                }
//            });
        });
        //删除收货地址信息
        $(".DelAddr").click(function () {
            if (confirm('确认删除此信息?')) {
                var $this = $(this);
                $.post("/ajax/User/UserHandle.htm?act=DelAddr&TypeID=0", { "ID": $this.parents("li").find(":radio").attr("index") }, function (data) {
                    //window.location = 'http://v4.gjw.com/purchase/OrderInfo.htm'
                    $this.parents("li").remove();
                });
            }
        });

        //修改收货地址信息
        $(".EditAddr").click(function () {
            var $this = $(this);
            $.post("/ajax/User/UserHandle.htm?act=SelectAddr", { "ID": $this.parents("li").find(":radio").attr("index") }, function (data) {
                var json = eval(data)[0];
                if (json.Success == 1) {
                    var jsonAddr = eval(json.Message)[0];
                    $("#TypeID").val("1");
                    $("#consignee").val(jsonAddr.Consignee);
                    $("#drpProvince").val(jsonAddr.ProvinceID);
                    var dd = new Date();
                    var Millisecond = dd.getMilliseconds();
                    ChangBandDropDown($("#drpCity"), "/Ajax/NameValueList-act-GetCity-Id-" + jsonAddr.ProvinceID + ".htm", jsonAddr.CityID);
                    ChangBandDropDown($("#drpCounty"), "/Ajax/NameValueList-act-GetCounty-Id-" + jsonAddr.CityID + ".htm", jsonAddr.CountyID);
                    $("#address").val(jsonAddr.Addr);
                    $("#mobile").val(jsonAddr.Mob);
                    $("#tel").val(jsonAddr.Tel);
                    $("#addr_edit_table").show();
                }
                else {
                    window.location = 'http://v4.gjw.com/purchase/OrderInfo.htm'
                }
            });
        });

        //        var oCheckCash = $("#checkedCash");
        //        var checkCash = function () {
        //            var card = oCashCoupon.find("p").eq(1).find("input").eq(0).val(),
        //		pwd = oCashCoupon.find("p").eq(1).find("input").eq(1).val();
        //            if (card != "" && pwd != "") {
        //                var oItem = "<p class='mb2'><input type='radio' value='100' id='cashCoupon3' name='cashCoupon' class='vm'><label for='cashCoupon3'>12月店庆活动满300减100优惠券，余额100.00元，有效期至：2011-12-30.</label><a class='cd5 ml10' style='visibility:hidden;' href='javascript:;'>[取消使用]</a></p>";
        //                $("#coupon").append(oItem);
        //                fnCoupon();
        //                oCashCoupon.find("p").eq(1).find(".voucher_s_tip").text("验证成功，请在上方选择您要使用的电子劵。").css({
        //                    "display": "inline-block",
        //                    "background": "#EAFFE8",
        //                    "border": "1px solid #8CED6D",
        //                    "color": "#2EAD35"
        //                });
        //            } else {
        //                oCashCoupon.find("p").eq(1).find(".voucher_s_tip").text("卡号或密码不正确。").css({
        //                    "display": "inline-block",
        //                    "background": "#FEEFEF",
        //                    "border": "1px solid #EB8797",
        //                    "color": "#EB1A3C"
        //                });
        //            }
        //        }
        //        oCheckCash.bind("click", checkCash);
        $("#checkedCash").click(function () {
            $.post("/ajax/Order/Order.htm?act=VouchersCode_Psw", { "Number": $("#txtNumber").val(), "Password": $("#txtPassword").val() }, function (data) {
                var json = eval(data)[0];
                if (json.Success == 1) {
                    var v = "<p class='mb2'><input type='radio' value='" + json.Message.split('$')[1] + "' id='Vouchers_" + json.Message.split('$')[1] + "' name='cashCoupon' class='vm' checked=\"checked\"><label for='Vouchers_" + json.Message.split('$')[1] + "'>" + json.Message.split('$')[2] + "，有效期至：" + json.Message.split('$')[3] + ".</label><a class='cd5 ml10' href='javascript:;' onclick='DelVouchers(this)'>[取消使用]</a></p>";
                    $("#coupon").append(v);
                    $("#lbVoucherMoney").html(json.Message.split('$')[0]);
                    //$("#SumMoney").html(parseFloat($("#lbSumProMoney").html()) + parseFloat($("#lbFreight").html()) - parseFloat(json.Message) - parseFloat($("#lbSumReductionMoney").html()));
                    GetMyMoney();
                }
                else {
                    alert(json.Message);
                }
            });
        });
        checkAddr();

        $("#txtIntro").focus(function () {
            if ($(this).val() == "请勿再次输入有关配送地址、支付方式、发票信息等信息。谢谢！") {
                $(this).val("");
            }
        });
        $("#txtIntro").blur(function () {
            if ($(this).val() == "") {
                $(this).val(this.defaultValue);
            };
        });

        /*Money格式*/
        $("#txtAccount").keydown(function (e) {
            var code = e.keyCode;
            var b1 = code >= 96 && code <= 105;
            var b2 = code >= 48 && code <= 57;
            var b3 = code == 8 || code == 46 || code == 37 || code == 38 || code == 39 || code == 40 || code == 110;
            return b1 || b2 || b3;
        });

        $("#AOk").click(function () {
            var Money = $("#txtAccount").val();
            if (Money == "") {
                alert("请输入正确的金额!");
                return;
            }
            else {
                if (parseFloat(Money) <= 0) {
                    alert("请输入正确的金额!");
                    return;
                }
            }
            $.post("/ajax/Order/Order.htm?act=Account", { "Money": Money }, function (data) {
                var json = eval(data)[0];
                if (json.Success == 1) {
                    $("#AOk").css("display", "none");
                    $("#spOk").css("display", "inline");
                    $("#ARest").css("display", "inline");
                    $("#txtAccount").val(json.Message.split('$')[0]);
                    $("#txtAccount").attr("disabled", "disabled");
                    $("#lbAccount").html(json.Message.split('$')[0]);
                    $("#spAccount").html(json.Message.split('$')[1]);
                    GetMyMoney();
                }
                else {
                    alert(json.Message);
                }
            });
        });

        $("#ARest").click(function () {
            $.post("/ajax/Order/Order.htm?act=AccountRest", function (data) {
                var json = eval(data)[0];
                if (json.Success == 1) {
                    $("#AOk").css("display", "inline");
                    $("#spOk").css("display", "none");
                    $("#ARest").css("display", "none");
                    $("#txtAccount").val("");
                    $("#txtAccount").removeAttr("disabled");
                    $("#lbAccount").html(json.Message.split('$')[0]);
                    $("#spAccount").html(json.Message.split('$')[1]);
                    GetMyMoney();
                }
                else {
                    alert(json.Message);
                }
            });
        });

        $("#btnOk").click(function () {
            var TypeID = $.trim($("#TypeID").val());
            var Consignee = $.trim($("#consignee").val());
            var CountyID = $("#drpCounty").val();
            var address = $.trim($("#address").val());
            var mob = $("#mobile").val();
            var tel = $("#tel").val();
            if (TypeID == "1") {
                if (Consignee == "") {
                    alert("请填写收货人姓名!");
                    $("#consignee").focus();
                    scroll(0, $("#consignee").offset().top - 60);
                    return;
                }
                if (CountyID == "") {
                    alert("请选择所在城市!");
                    $("#drpCounty").focus();
                    scroll(0, $("#consignee").offset().top - 60);
                    return;
                }
                if (address == "") {
                    alert("请填写详细地址!");
                    $("#address").focus();
                    scroll(0, $("#consignee").offset().top - 60);
                    return;
                }
                if (mob == "" && tel == "") {
                    alert("手机和固定电话至少填写一项!");
                    $("#mobile").focus();
                    scroll(0, $("#consignee").offset().top - 60);
                    return;
                } else {
                    if (mob != "") {
                        var patrn = /^1[3,4,5,8]\d{9}$/;
                        if (!patrn.exec(mob)) {
                            alert("手机号格式不正确!");
                            $("#mobile").focus();
                            scroll(0, $("#consignee").offset().top - 60);
                            return;
                        }
                    }
                    if (tel != "") {
                        var patrn = /^(\d{4}-)(\d{8})$|(\d{4})(\d{8})$|(\d{3}-)(\d{8})$|(\d{4}-)(\d{7})$|(\d{3})(\d{8})$|(\d{4})(\d{7})$/;
                        if (!patrn.exec(tel)) {
                            alert("电话格式不正确!");
                            $("#tel").focus();
                            scroll(0, $("#consignee").offset().top - 60);
                            return;
                        }
                    }
                }
            } else {
                AddressID = $("input[name=addr][checked]").val();
            }
            var Intro = $.trim($("#txtIntro").val());
            if (Intro == "请勿再次输入有关配送地址、支付方式、发票信息等信息。谢谢！") {
                Intro = "";
            }
            else {
                if (Intro.length > 32) {
                    alert("留言信息请在32个字以内!");
                    return;
                }
            }
            var InvoiceTitle = $.trim($("#txtInvoiceTitle").val());
            $("#btnOk").attr("disabled", "disabled");
            $("#btnOk").addClass("loading_btn");
            var dd = new Date();
            $.post(
                "/Order/Add?time=" + escape(dd),
                { "TypeID": TypeID, "AddressID": AddressID, "Consignee": Consignee, "Intro": Intro, "CountyID": CountyID, "Address": address, "Mobile": mob, "Tel": tel, "InvoiceTitle": InvoiceTitle, "InvoiceContent": $("#drpInvoiceType").find('option:selected').val(), "PaymentType": 0 },
                function (data) {
                    $("#btnOk").attr("class", "fr cbtn porder_btn");
                    if (data.State == 1) {
                        window.location = '/Order/Success?oid=' + data.Data;
                    } else {
                        alert(data.Massge);
                    }
//                    else if (data.Success == 2) {
//                        $("#btnOk").removeAttr("disabled");
//                        $("#divDelCart").html(json.Message);
//                        TB_show("以下产品无法配送至您选择的地区", "divDelCart.dom?width=650");
//                        return;
//                    }
//                    else if (json.Success == 3) {
//                        alert(json.Message);
//                        window.location = 'http://v4.gjw.com/purchase/Finish.htm';
//                    }
//                    else {
//                        alert(json.Message);
//                        $("#btnOk").removeAttr("disabled");
//                    }
                });
        });
    });
</script>